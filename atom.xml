<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>BLOG</title>
  
  
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2020-10-28T23:05:33.703Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>Dylan Liu</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>MobileDevelopment</title>
    <link href="http://example.com/2020/10/21/MobileDevelopment/"/>
    <id>http://example.com/2020/10/21/MobileDevelopment/</id>
    <published>2020-10-21T15:17:35.000Z</published>
    <updated>2020-10-28T23:05:33.703Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Introduction</strong> This note will be used to keep track of all the knowledge gained during Android development  </p><h1 id="Development-Component"><a href="#Development-Component" class="headerlink" title="Development Component"></a>Development Component</h1><h2 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h2><h3 id="Step-1-Create-Service-class-whihc-extends-Service"><a href="#Step-1-Create-Service-class-whihc-extends-Service" class="headerlink" title="Step 1: Create Service class whihc extends Service"></a>Step 1: Create Service class whihc extends Service</h3><p><img src="/img/Mobile/02.jpg" alt="Instruction">  </p><h3 id="Step-2-Start-amp-stop-service"><a href="#Step-2-Start-amp-stop-service" class="headerlink" title="Step 2: Start &amp; stop service"></a>Step 2: Start &amp; stop service</h3><p>普通的Service的生命周期很简单，分别为onCreate、onStartCommand、onDestroy这三个。当我们startService()的时候，首次创建Service会回调onCreate()方法，然后回调onStartCommand()方法，再次startService()的时候，就只会执行onStartCommand()。服务一旦开启后，我们就需要通过stopService()方法或者stopSelf()方法关闭服务，这时就会回调onDestroy()</p><p><strong>MainActivity.class</strong>  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; start</span><br><span class="line">Intent sIntent &#x3D; new Intent(this, Myservice.class)</span><br><span class="line">startService(sIntent)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; stop</span><br><span class="line">stopService(sIntent)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>MyService.class</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; startService would invoke onStartCommand method in MyService class</span><br><span class="line">&#x2F;&#x2F; In general, this method would create sub-thread to running service</span><br><span class="line">public int onStartCommand(Intent intent, int flags, int startId) &#123;</span><br><span class="line">Runnable runnable &#x3D; new Runnable() &#123;</span><br><span class="line">@Override</span><br><span class="line">public void run() &#123;</span><br><span class="line">Log.i(TAG, &quot;generate random number running&quot;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">Thread thread &#x3D; new Thread(runnable);</span><br><span class="line">&#x2F;&#x2F; execute linearly not multi-thread, would stoke program</span><br><span class="line">&#x2F;&#x2F; thread.run();</span><br><span class="line">&#x2F;&#x2F; achieve multi-thread</span><br><span class="line">thread.start();</span><br><span class="line">&#x2F;*</span><br><span class="line">START_STICKY: automatically restart after being killed and calls onStartCommand again, it can accept the new task instead of continuing with the previous task</span><br><span class="line">START_NOT_STICKY: Do not restart after being killed, do not keep the startup state, can stop at any time</span><br><span class="line">START_REDELIVER_INTENT: If there is an unfinished Intent, it is restarted after being killed, and all intents are sent after the restart. After stopSelf releases the maintained Intent.</span><br><span class="line">*&#x2F;</span><br><span class="line">return START_NOT_STICKY;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; stopService</span><br><span class="line">public void onDestroy() &#123;</span><br><span class="line">super.onDestroy();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Step-3-Bind-amp-Unbind-service"><a href="#Step-3-Bind-amp-Unbind-service" class="headerlink" title="Step 3: Bind &amp; Unbind service"></a>Step 3: Bind &amp; Unbind service</h3><p><strong>MainActivity.class</strong>  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; bind</span><br><span class="line">private void bindMyService() &#123;</span><br><span class="line">if (myServiceConnection &#x3D;&#x3D; null) &#123;</span><br><span class="line">myServiceConnection &#x3D; new ServiceConnection() &#123;</span><br><span class="line">@Override</span><br><span class="line">public void onServiceConnected(ComponentName componentName, IBinder iBinder) &#123;</span><br><span class="line">Log.i(TAG, &quot;onServiceConnected&quot;);</span><br><span class="line">MyService.MyBinder binder &#x3D; (MyService.MyBinder) iBinder;myService &#x3D; ((MyService.MyBinder) iBinder).getService();                 </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">public void onServiceDisconnected(ComponentName componentName) &#123;</span><br><span class="line">Log.i(TAG, &quot;onServiceDisconnected&quot;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Intent, new Service Connection</span><br><span class="line">&#x2F;&#x2F; BIND_AUTO_CREATE: check if there are connections before stoping services</span><br><span class="line"></span><br><span class="line">bindService(sIntent, myServiceConnection, BIND_AUTO_CREATE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; unbind</span><br><span class="line">private void unbindMyService() &#123;</span><br><span class="line">unbindService(myServiceConnection);</span><br><span class="line">myServiceConnection &#x3D; null;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>MyService.class</strong></p><p><strong>bind</strong><br>Define Binder class</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public class MyBinder extends Binder &#123;</span><br><span class="line">        public MyService getService() &#123;</span><br><span class="line">            return MyService.this;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Define MyBinder instance</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private Binder myBinder &#x3D; new MyBinder();</span><br></pre></td></tr></table></figure><p>Define onBind Method return binder</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">&#x2F;&#x2F; you can get this binder in creating serviceConnection in MainActivity.class</span><br><span class="line">public IBinder onBind(Intent intent) &#123;</span><br><span class="line">return myBinder;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Unbind</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public void unbindService(ServiceConnection conn) &#123;</span><br><span class="line">super.unbindService(conn);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://github.com/zx1314621/Service_Demo">Demo</a> </p><h2 id="ListView"><a href="#ListView" class="headerlink" title="ListView"></a>ListView</h2><h3 id="Define-Item-in-the-listview"><a href="#Define-Item-in-the-listview" class="headerlink" title="Define Item in the listview"></a>Define Item in the listview</h3><p>define attribute of every row</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public class Item &#123;</span><br><span class="line">    private String name;</span><br><span class="line">    private int img_url;</span><br><span class="line"></span><br><span class="line">    public String getName() &#123;</span><br><span class="line">        return name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setName(String name) &#123;</span><br><span class="line">        this.name &#x3D; name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Item(String name) &#123;</span><br><span class="line">        this.name &#x3D; name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public int getImg_url() &#123;</span><br><span class="line">        return img_url;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public void setImg_url(int img_url) &#123;</span><br><span class="line">        this.img_url &#x3D; img_url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Define-xml-in-each-item"><a href="#Define-xml-in-each-item" class="headerlink" title="Define xml in each item"></a>Define xml in each item</h3><p>show in each row</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class="line">    android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">    android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class="line">    android:orientation&#x3D;&quot;horizontal&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;ImageView</span><br><span class="line">        android:id&#x3D;&quot;@+id&#x2F;item_image&quot;</span><br><span class="line">        android:layout_width&#x3D;&quot;130dp&quot;</span><br><span class="line">        android:layout_height&#x3D;&quot;130dp&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:id&#x3D;&quot;@+id&#x2F;item_name&quot;</span><br><span class="line">        android:layout_width&#x3D;&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class="line">        android:textStyle&#x3D;&quot;bold&quot;</span><br><span class="line">        android:textColor&#x3D;&quot;#0000EE&quot;</span><br><span class="line">        android:layout_marginLeft&#x3D;&quot;10dp&quot;</span><br><span class="line">        android:layout_marginTop&#x3D;&quot;30dp&quot;</span><br><span class="line">        android:textSize&#x3D;&quot;25sp&quot;</span><br><span class="line">        android:gravity&#x3D;&quot;center&quot;&#x2F;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;&#x2F;LinearLayout&gt;</span><br></pre></td></tr></table></figure><h3 id="Define-Adapter"><a href="#Define-Adapter" class="headerlink" title="Define Adapter"></a>Define Adapter</h3><p>Connect the <strong>background data</strong> to <strong>the foreground style</strong>   </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">public class ItemAdapter extends ArrayAdapter&lt;Item&gt; &#123;</span><br><span class="line">    private int resourceId;</span><br><span class="line">    public ItemAdapter(Context context,int textViewResourceId, List&lt;Item&gt; objects)&#123;</span><br><span class="line">        super(context, textViewResourceId, objects);</span><br><span class="line">        resourceId &#x3D; textViewResourceId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public View getView(int position, View convertView, ViewGroup parent) &#123;</span><br><span class="line">        Item item &#x3D; getItem(position);</span><br><span class="line">        View view;</span><br><span class="line">        ViewHolder viewHolder;</span><br><span class="line"></span><br><span class="line">        if (convertView &#x3D;&#x3D; null)&#123;</span><br><span class="line">            view &#x3D; LayoutInflater.from(getContext()).inflate(resourceId, null);</span><br><span class="line"></span><br><span class="line">            viewHolder &#x3D; new ViewHolder();</span><br><span class="line">            viewHolder.itemImage &#x3D; (ImageView) view.findViewById(R.id.item_image);</span><br><span class="line">            viewHolder.itemName &#x3D; (TextView) view.findViewById(R.id.item_name);</span><br><span class="line"></span><br><span class="line">            view.setTag(viewHolder);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            view &#x3D; convertView;</span><br><span class="line">            viewHolder &#x3D; (ViewHolder) view.getTag();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        viewHolder.itemImage.setImageResource(item.getImg_url());</span><br><span class="line">        viewHolder.itemName.setText(item.getName());</span><br><span class="line">        return view;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class ViewHolder&#123;</span><br><span class="line">        ImageView itemImage;</span><br><span class="line">        TextView itemName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="MainActivity-Omit-definition-MainActivity-XML"><a href="#MainActivity-Omit-definition-MainActivity-XML" class="headerlink" title="MainActivity(Omit definition MainActivity.XML)"></a>MainActivity(Omit definition MainActivity.XML)</h3><p>set Data and click listener</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">&#x2F;&#x2F; define data source</span><br><span class="line">List&lt;Item&gt; itemList &#x3D; new ArrayList&lt;Item&gt;();</span><br><span class="line">Item alpha &#x3D; new Item(&quot;Alpha&quot;,R.drawable.alpha, &quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Alpha&quot;,&quot;API 1&quot;);</span><br><span class="line">        itemList.add(alpha);</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; add and set adapter</span><br><span class="line">ItemAdapter adapter &#x3D; new ItemAdapter(MainActivity.this,R.layout.item, itemList);</span><br><span class="line"></span><br><span class="line">       ListView listView &#x3D; (ListView) findViewById(R.id.list_view);</span><br><span class="line">       listView.setAdapter(adapter);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; add click listener</span><br><span class="line">        listView.setOnItemClickListener(new AdapterView.OnItemClickListener()&#123;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void onItemClick(AdapterView&lt;?&gt; parent, View view,</span><br><span class="line">                                    int position, long id) &#123;</span><br><span class="line">                &#x2F;&#x2F; TODO Auto-generated method stub</span><br><span class="line">                Item info &#x3D; itemList.get(position);</span><br><span class="line">                Bundle bundle &#x3D; new Bundle();</span><br><span class="line"></span><br><span class="line">                bundle.putString(&quot;itemName&quot;, info.getName());</span><br><span class="line">                bundle.putString(&quot;itemImage&quot;, info.getImg_url() + &quot;&quot;);</span><br><span class="line">                bundle.putString(&quot;itemLink&quot;, info.getLink());</span><br><span class="line"></span><br><span class="line">                Intent intent &#x3D; new Intent(MainActivity.this,ItemPage.class);</span><br><span class="line">                intent.putExtras(bundle);</span><br><span class="line">                startActivity(intent);</span><br><span class="line">            &#125;</span><br><span class="line">&#125;);</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h2 id="ToolBar"><a href="#ToolBar" class="headerlink" title="ToolBar"></a>ToolBar</h2><h3 id="Hide-actionbar-to-show-toolbar"><a href="#Hide-actionbar-to-show-toolbar" class="headerlink" title="Hide actionbar to show toolbar"></a>Hide actionbar to show toolbar</h3><p>Change theme of this activity in AndroidManifest.xml, and this theme is define in styles.xml  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; AndroidManifest.xml</span><br><span class="line">      &lt;activity android:name&#x3D;&quot;.activity_name&quot;</span><br><span class="line">          android:theme&#x3D;&quot;@style&#x2F;AppTheme.NoActionBar&quot;</span><br><span class="line">          &gt;&lt;&#x2F;activity&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; styles.xml</span><br><span class="line"> &lt;style name&#x3D;&quot;AppTheme.NoActionBar&quot;&gt;  </span><br><span class="line">        &lt;item name&#x3D;&quot;windowNoTitle&quot;&gt;true&lt;&#x2F;item&gt;  </span><br><span class="line">        &lt;item name&#x3D;&quot;windowActionBar&quot;&gt;false&lt;&#x2F;item&gt;  </span><br><span class="line">    &lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure><h3 id="Define-XML"><a href="#Define-XML" class="headerlink" title="Define XML"></a>Define XML</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; there is a back button in ToolBar</span><br><span class="line">    &lt;androidx.appcompat.widget.Toolbar</span><br><span class="line">        android:theme&#x3D;&quot;@style&#x2F;ThemeOverlay.AppCompat.Dark.ActionBar&quot;</span><br><span class="line">        android:id&#x3D;&quot;@+id&#x2F;toolbar&quot;</span><br><span class="line">        android:background&#x3D;&quot;?colorPrimary&quot;</span><br><span class="line">        android:layout_width&#x3D;&quot;fill_parent&quot;</span><br><span class="line">        android:layout_height&#x3D;&quot;?actionBarSize&quot;</span><br><span class="line">        android:minHeight&#x3D;&quot;?actionBarSize&quot;</span><br><span class="line">        app:popupTheme&#x3D;&quot;?actionBarPopupTheme&quot;</span><br><span class="line">        app:navigationIcon&#x3D;&quot;?homeAsUpIndicator&quot;</span><br><span class="line">        xmlns:app&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res-auto&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure><h3 id="MainActivity"><a href="#MainActivity" class="headerlink" title="MainActivity"></a>MainActivity</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">mToolbar &#x3D; (androidx.appcompat.widget.Toolbar) findViewById(R.id.toolbar);</span><br><span class="line">&#x2F;&#x2F; set support to this toolbar</span><br><span class="line">        setSupportActionBar((Toolbar) mToolbar);</span><br><span class="line">        &#x2F;&#x2F; set click listener</span><br><span class="line">        ((Toolbar) mToolbar).setNavigationOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onClick(View v) &#123;</span><br><span class="line">                finish();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h2 id="WebView"><a href="#WebView" class="headerlink" title="WebView"></a>WebView</h2><h3 id="Define-XML-1"><a href="#Define-XML-1" class="headerlink" title="Define XML"></a>Define XML</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;WebView</span><br><span class="line">        android:id&#x3D;&quot;@+id&#x2F;web_view&quot;</span><br><span class="line">        android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">        android:layout_height&#x3D;&quot;match_parent&quot;&#x2F;&gt;</span><br></pre></td></tr></table></figure><h3 id="open-permission-in-AndroidManifest-xml"><a href="#open-permission-in-AndroidManifest-xml" class="headerlink" title="open permission in AndroidManifest.xml"></a>open permission in AndroidManifest.xml</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:name&#x3D;&quot;android.permission.INTERNET&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure><h3 id="MainActivity-1"><a href="#MainActivity-1" class="headerlink" title="MainActivity"></a>MainActivity</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">webView &#x3D; (WebView) findViewById(R.id.web_view);</span><br><span class="line">      webView.getSettings().setJavaScriptEnabled(true);</span><br><span class="line">      webView.loadUrl(link);</span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line">      &#x2F;&#x2F; not jump to external browser</span><br><span class="line">      webView.setWebViewClient(new WebViewClient()&#123;</span><br><span class="line">          @Override</span><br><span class="line">          public boolean shouldOverrideUrlLoading(WebView view, String url) &#123;</span><br><span class="line">              view.loadUrl(url);</span><br><span class="line">              return super.shouldOverrideUrlLoading(view, url);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;);</span><br></pre></td></tr></table></figure><h2 id="Intent"><a href="#Intent" class="headerlink" title="Intent"></a>Intent</h2><p><strong>post</strong> </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; add attribute</span><br><span class="line">Bundle bundle &#x3D; new Bundle();</span><br><span class="line"></span><br><span class="line">            bundle.putString(&quot;itemName&quot;, info.getName());</span><br><span class="line">            bundle.putString(&quot;itemImage&quot;, info.getImg_url() + &quot;&quot;);</span><br><span class="line">            bundle.putString(&quot;itemLink&quot;, info.getLink());</span><br><span class="line"></span><br><span class="line">            Intent intent &#x3D; new Intent(MainActivity.this,ItemPage.class);</span><br><span class="line">            &#x2F;&#x2F; first way post</span><br><span class="line">            &#x2F;&#x2F; intent.putExtra(&quot;itemLink&quot;,info.getLink());</span><br><span class="line">            &#x2F;&#x2F; second way post</span><br><span class="line">            intent.putExtras(bundle);</span><br><span class="line">            startActivity(intent);</span><br><span class="line">            &#x2F;&#x2F; if finish() cannot back again</span><br><span class="line">            &#x2F;&#x2F; finish();</span><br></pre></td></tr></table></figure><p><strong>get</strong>  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; first way get</span><br><span class="line">&#x2F;&#x2F; getIntent().getStringExtra(&quot;link&quot;);</span><br><span class="line">&#x2F;&#x2F; second way get</span><br><span class="line"> Bundle b&#x3D;getIntent().getExtras();</span><br><span class="line">      &#x2F;&#x2F;获取Bundle的信息</span><br><span class="line">      String link &#x3D; b.getString(&quot;itemLink&quot;);</span><br></pre></td></tr></table></figure><h2 id="Version-Problem-between-AndroidX-and-android-support-v7-XXX"><a href="#Version-Problem-between-AndroidX-and-android-support-v7-XXX" class="headerlink" title="Version Problem between AndroidX and android.support.v7.XXX"></a>Version Problem between AndroidX and android.support.v7.XXX</h2><p><a href="https://blog.csdn.net/u011041494/article/details/93849730">CSDN Version Control</a> </p><h2 id="Android-Studio-emulator-rotate-screen-portrait-amp-landsacpe"><a href="#Android-Studio-emulator-rotate-screen-portrait-amp-landsacpe" class="headerlink" title="Android Studio emulator rotate screen(portrait &amp; landsacpe)"></a>Android Studio emulator rotate screen(portrait &amp; landsacpe)</h2><p><img src="/img/Mobile/01.jpg" alt="Instruction"> </p><p><a href="https://github.com/zx1314621/ListViewClick">Demo</a> </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;Introduction&lt;/strong&gt; This note will be used to keep track of all the knowledge gained during Android development  &lt;/p&gt;
&lt;h1 id=&quot;D</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>Leetcode</title>
    <link href="http://example.com/2020/10/15/Leetcode/"/>
    <id>http://example.com/2020/10/15/Leetcode/</id>
    <published>2020-10-15T15:56:11.000Z</published>
    <updated>2020-11-03T23:54:03.189Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Instroduction</strong> In order to summarize the algorithm of Leetcode encountered</p><a id="more"></a><h1 id="DP"><a href="#DP" class="headerlink" title="DP"></a>DP</h1><h3 id="1626-Best-Team-With-No-Conflicts"><a href="#1626-Best-Team-With-No-Conflicts" class="headerlink" title="1626. Best Team With No Conflicts"></a>1626. Best Team With No Conflicts</h3><p><strong>Question description</strong><br><a href="https://leetcode.com/problems/best-team-with-no-conflicts/">1626. Best Team With No Conflicts</a>You are the manager of a basketball team. For the upcoming tournament, you want to choose the team with the highest overall score. The score of the team is the sum of scores of all the players in the team.</p><p>However, the basketball team is not allowed to have conflicts. A conflict exists if a younger player has a strictly higher score than an older player. A conflict does not occur between players of the same age.</p><p>Given two lists, scores and ages, where each scores[i] and ages[i] represents the score and age of the ith player, respectively, return the highest overall score of all possible basketball teams. </p><ul><li><p>Example 1  </p><blockquote><p>Input: scores = [1,3,5,10,15], ages = [1,2,3,4,5]<br>Output: 34(choose all)</p></blockquote></li><li><p>Example 2</p><blockquote><p>Input: scores = [4,5,6,5], ages = [2,1,2,1]<br>Output: 16(last 3)</p></blockquote></li><li><p>Example 3</p><blockquote><p>Input: scores = [1,2,3,5], ages = [8,9,10,1]<br>Output: 6(first 3)</p></blockquote></li><li><p>Constraints:</p><blockquote><p>1 &lt;= scores.length, ages.length &lt;= 1000<br>scores.length == ages.length<br>1 &lt;= scores[i] &lt;= 10<sup>6</sup><br>1 &lt;= ages[i] &lt;= 1000  </p></blockquote></li></ul><h3 id="Code-amp-Explanation"><a href="#Code-amp-Explanation" class="headerlink" title="Code &amp; Explanation"></a>Code &amp; Explanation</h3><p>Idea is to first sort the players by their age so that we don’t have to always check both the scores and the age to see whether these two players can be in the same team.</p><p>We sort age(first) and score(second) in the ascending/descending order<br>Now we know that for any player i, we can choose any player from 0 to i-1 as long as that player has higher score than this i-th player.</p><p>dp[i] stores the maximum score that can be obtained when i-th player is included and all other players are between indices 0 and i-1.<br>Once we get the answer for all indices, we can simply find the max and that will be the answer.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line">    class People &#123;</span><br><span class="line">        int age;</span><br><span class="line">        int score;</span><br><span class="line">        public People(int age, int score) &#123;</span><br><span class="line">            this.age &#x3D; age;</span><br><span class="line">            this.score &#x3D; score;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public int bestTeamScore(int[] scores, int[] ages) &#123;</span><br><span class="line">        if (scores &#x3D;&#x3D; null || ages &#x3D;&#x3D; null || scores.length !&#x3D; ages.length) return -1;</span><br><span class="line">        </span><br><span class="line">        int n &#x3D; scores.length;</span><br><span class="line">        People[] people &#x3D; new People[n];</span><br><span class="line">        for (int i &#x3D; 0; i &lt; n; i++) &#123;</span><br><span class="line">            people[i] &#x3D; new People(ages[i], scores[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        Arrays.sort(people, (a, b) -&gt; (a.age !&#x3D; b.age ? a.age - b.age : a.score - b.score));</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        int[] dp &#x3D; new int[n];</span><br><span class="line">        dp[0] &#x3D; people[0].score;</span><br><span class="line">        int res &#x3D; dp[0];</span><br><span class="line">        </span><br><span class="line">        for (int i &#x3D; 1; i &lt; n; i++) &#123;</span><br><span class="line">            dp[i] &#x3D; people[i].score;</span><br><span class="line">            for (int j &#x3D; 0; j &lt; i; j++) &#123;</span><br><span class="line">                if (people[j].age &#x3D;&#x3D; people[i].age || people[j].score &lt;&#x3D; people[i].score) &#123;</span><br><span class="line">                    dp[i] &#x3D; Math.max(dp[i], dp[j] + people[i].score);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            res &#x3D; Math.max(dp[i], res);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        return res;</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Complexity"><a href="#Complexity" class="headerlink" title="Complexity"></a>Complexity</h3><p>Time: O(n<sup>2</sup>)<br>Space: O(n)</p><h3 id="1641-Count-Sorted-Vowel-Strings"><a href="#1641-Count-Sorted-Vowel-Strings" class="headerlink" title="1641. Count Sorted Vowel Strings"></a>1641. Count Sorted Vowel Strings</h3><p><strong>Question description</strong><br>Given an integer n, return the number of strings of length n that consist only of vowels (a, e, i, o, u) and are lexicographically sorted.<br>A string s is lexicographically sorted if for all valid i, s[i] is the same as or comes before s[i+1] in the alphabet.</p><ul><li><p>Example 1  </p><blockquote><p>Input: n = 1<br>Output: 1</p></blockquote><blockquote><p>Explanation: The 5 sorted strings that consist of vowels only are [“a”,”e”,”i”,”o”,”u”].</p></blockquote></li><li><p>Example 2  </p><blockquote><p>Input: n = 2<br>Output: 15</p></blockquote><blockquote><p>Explanation: The 15 sorted strings that consist of vowels only are<br>[“aa”,”ae”,”ai”,”ao”,”au”,”ee”,”ei”,”eo”,”eu”,”ii”,”io”,”iu”,”oo”,”ou”,”uu”].<br>Note that “ea” is not a valid string since ‘e’ comes after ‘a’ in the alphabet.</p></blockquote></li><li><p>Example 3  </p><blockquote><p>Input: n = 33</p></blockquote><blockquote><p>Output: 66045    </p></blockquote></li><li><p>Constraints:   </p><blockquote><p>1 &lt;= n &lt;= 50 </p></blockquote></li></ul><h3 id="Code-amp-Explanation-1"><a href="#Code-amp-Explanation-1" class="headerlink" title="Code &amp; Explanation"></a>Code &amp; Explanation</h3><p>j = 1 only have a<br>j = 2 only have a,e<br>j = 3 only have a,e,i<br>j = 4 only have a,e,i,o<br>j = 5 only have a,e,i,o,u  </p><table><thead><tr><th align="center"><sub>i</sub>\<sup>j</sup></th><th align="center">0</th><th align="center">1</th><th align="center">2</th><th align="center">3</th><th align="center">4</th><th align="center">5</th></tr></thead><tbody><tr><td align="center">0</td><td align="center">0</td><td align="center">1</td><td align="center">1</td><td align="center">1</td><td align="center">1</td><td align="center">1</td></tr><tr><td align="center">1</td><td align="center">0</td><td align="center">1</td><td align="center">2</td><td align="center">3</td><td align="center">4</td><td align="center">5</td></tr><tr><td align="center">2</td><td align="center">0</td><td align="center">1</td><td align="center">3</td><td align="center">6</td><td align="center">10</td><td align="center">15</td></tr><tr><td align="center">3</td><td align="center">0</td><td align="center">1</td><td align="center">4</td><td align="center">10</td><td align="center">20</td><td align="center">35</td></tr><tr><td align="center">4</td><td align="center">0</td><td align="center">1</td><td align="center">5</td><td align="center">15</td><td align="center">35</td><td align="center">70</td></tr><tr><td align="center">5</td><td align="center">0</td><td align="center">1</td><td align="center">6</td><td align="center">21</td><td align="center">56</td><td align="center">126</td></tr></tbody></table><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line">    public int countVowelStrings(int n) &#123;</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; tradition dp</span><br><span class="line">        &#x2F;&#x2F; int[][] dp &#x3D; new int[n + 1][6];</span><br><span class="line">        &#x2F;&#x2F; Arrays.fill(dp[0], 1);</span><br><span class="line">        &#x2F;&#x2F; for (int i &#x3D; 1; i &lt;&#x3D; n; i++) &#123;</span><br><span class="line">        &#x2F;&#x2F;     for (int j &#x3D; 1; j &lt; 6; j++) &#123;</span><br><span class="line">        &#x2F;&#x2F;         dp[i][j] &#x3D; j &#x3D;&#x3D; 1 ? 1 : dp[i][j-1] + dp[i-1][j];</span><br><span class="line">        &#x2F;&#x2F;     &#125;</span><br><span class="line">        &#x2F;&#x2F; &#125;</span><br><span class="line">        &#x2F;&#x2F; return dp[n][5];</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; reduce space complexity</span><br><span class="line">        int[] dp &#x3D; new int[6];</span><br><span class="line">        for (int i &#x3D; 1; i &lt; 6; i++) dp[i] &#x3D; 1;</span><br><span class="line">        </span><br><span class="line">        for (int k &#x3D; 1; k &lt;&#x3D; n; k++) &#123;</span><br><span class="line">            for (int i &#x3D; 1; i &lt; 6; i++) &#123;</span><br><span class="line">                dp[i] +&#x3D; dp[i-1];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        return dp[5];</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;*</span><br><span class="line">    1 a e i o u</span><br><span class="line">    2 aa ae ai ao au, ee ei eo eu, ii io iu, oo ou, uu</span><br><span class="line">    3 aaa aae aai aao aau, aee aei aeo aeu, aii aio aiu, aoo aou, auu; eee eei eeo eeu, eii eio eu, eoo eou, euu;</span><br><span class="line">    iii iio iiu, ioo iou, iuu; ooo oou, ouu; uuu</span><br><span class="line">    *&#x2F;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Complexity-1"><a href="#Complexity-1" class="headerlink" title="Complexity"></a>Complexity</h3><p>Time: O(nk)<br>Space: O(k)</p><p><strong>Solution 2: Combination number</strong><br>Now we have n characters, we are going to insert 4 l inside.<br>We can add in the front, in the middle and in the end.<br>How many ways do we have?<br>For the 1st l, we have n+1 position to insert.<br>For the 2nd l, we have n+2 position to insert.<br>For the 3rd l, we have n+3 position to insert.<br>For the 4th l, we have n+4 position to insert.<br>Also 4 l are the same,<br>there are (n + 1) * (n + 2) * (n + 3) * (n + 4) / 4! ways.</p><p>The character before the 1st l, we set to a.<br>The character before the 2nd l, we set to e.<br>The character before the 3rd l, we set to i.<br>The character before the 4th l, we set to o.<br>The character before the 5th l, we set to u.</p><p>We get the one result for the oringinal problem.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public int countVowelStrings(int n) &#123;</span><br><span class="line">        return (n + 1) * (n + 2) * (n + 3) * (n + 4) &#x2F; 24;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Complexity-2"><a href="#Complexity-2" class="headerlink" title="Complexity"></a>Complexity</h3><p>Time: O(1)<br>Space: O(1)</p><h1 id="Union-Find"><a href="#Union-Find" class="headerlink" title="Union Find"></a>Union Find</h1><h3 id="1627-Graph-Connectivity-With-Threshold"><a href="#1627-Graph-Connectivity-With-Threshold" class="headerlink" title="1627. Graph Connectivity With Threshold"></a>1627. Graph Connectivity With Threshold</h3><p><strong>Question description</strong></p><p><a href="https://leetcode.com/problems/graph-connectivity-with-threshold/">1627. Graph Connectivity With Threshold</a> We have n cities labeled from 1 to n. Two different cities with labels x and y are directly connected by a bidirectional road if and only if x and y share a common divisor strictly greater than some threshold. More formally, cities with labels x and y have a road between them if there exists an integer z such that all of the following are true:</p><ul><li>x % z == 0,</li><li>y % z == 0, and</li><li>z &gt; threshold.  </li></ul><p>Given the two integers, n and threshold, and an array of queries, you must determine for each queries[i] = [a<sub>i</sub>, b<sub>i</sub>] if cities a<sub>i</sub> and b<sub>i</sub> are connected (i.e. there is some path between them).</p><p>Return an array answer, where answer.length == queries.length and answer[i] is true if for the i<sup>th</sup> query, there is a path between a<sub>i</sub> and b<sub>i</sub>, or answer[i] is false if there is no path.</p><ul><li><p>Example 1  </p><blockquote><p>Input: n = 6, threshold = 2, queries = [[1,4],[2,5],[3,6]]<br>Output: [false,false,true]</p></blockquote><blockquote><p>Explanation: The divisors for each number:<br>  1:   1<br>2:   1, 2<br>3:   1, 3<br>4:   1, 2, 4<br>5:   1, 5<br>6:   1, 2, 3, 6<br>Using the underlined divisors above the threshold, only cities 3 and 6 share a common divisor, so they are the<br>only ones directly connected.The result of each query:<br>[1,4]   1 is not connected to 4<br>[2,5]   2 is not connected to 5<br>[3,6]   3 is connected to 6 through path 3–6  </p></blockquote></li><li><p>Example 2</p><blockquote><p>Input: n = 6, threshold = 0, queries = [[4,5],[3,4],[3,2],[2,6],[1,3]]<br>Output: [true,true,true,true,true]<br>Explanation: The divisors for each number are the same as the previous example. However, since the threshold is 0<br>all divisors can be used. Since all numbers share 1 as a divisor, all cities are connected.</p></blockquote></li><li><p>Example 3</p><blockquote><p>n = 5, threshold = 1, queries = [[4,5],[4,5],[3,2],[2,3],[3,4]]<br>Output: [false,false,false,false,false]<br>Explanation: Only cities 2 and 4 share a common divisor 2 which is strictly greater than the threshold 1, so they are the only ones directly connected.<br>Please notice that there can be multiple queries for the same pair of nodes [x, y], and that the query [x, y] is equivalent to the query [y, x].</p></blockquote></li><li><p>Constraints:</p><blockquote><p>2 &lt;= n &lt;= 10<sup>4</sup><br>0 &lt;= threshold &lt;= n<br>1 &lt;= queries.length &lt;= 10<sup>5</sup><br>queries[i].length == 2<br>1 &lt;= a<sub>i</sub>, b<sub>i</sub> &lt;= cities<br>a<sub>i</sub> != b<sub>i</sub>  </p></blockquote></li></ul><h3 id="Code-amp-Explanation-2"><a href="#Code-amp-Explanation-2" class="headerlink" title="Code &amp; Explanation"></a>Code &amp; Explanation</h3><p>Because the input sizes are fairly large, we must have close to constant time performance.<br>One can solve this problem by constructing a graph and then performing DFS for each query,<br>but it would quickly lead to TLE.</p><p>Idea here is to use union find data structure because all we care about is whether there<br>is exist an edge between a and b. If union-find finds that both a and b belong to the same<br>component, then there is an edge between them.</p><p>Now for union-find to do this, we will first setup the graph. Key idea to understand is that<br>any integer node a will be connected to all the multiples of a provided that a is greater than<br>the threshold. For each number from 1 to n, we will connect it to its multiples and then keep<br>queryin this awesome data structure.</p><p>Code should help you realize how easy all this is.</p><pre><code>class Solution &#123;    class UF &#123;        int distinct;        int[] roots;        int[] size;    public UF(int n) &#123;        this.distinct = n;        this.roots = new int[n + 1];        this.size = new int[n + 1];        for (int i = 1; i &lt;= n; i++) &#123;            this.roots[i] = i;            this.size[i] = 1;        &#125;    &#125;    private int findRoot(int n) &#123;        if (this.roots[n] == n) return n;        return this.roots[n] = findRoot(this.roots[n]);    &#125;    private void unite(int x, int y) &#123;        int root_x = findRoot(x);        int root_y = findRoot(y);        if (root_x == root_y) return;        // if (size[x] &gt; size[y]) &#123;        //     size[x] += size[y];        //     this.roots[root_y] = root_x;        // &#125; else &#123;        //     size[y] += size[x];        //     this.roots[root_x] = root_y;        // &#125;        if (root_x &lt; root_y) &#123;            this.roots[root_y] = root_x;        &#125; else &#123;            this.roots[root_x] = root_y;        &#125;        this.distinct--;    &#125;    private boolean connect(int i, int j) &#123;        return findRoot(i) == findRoot(j);    &#125;    private boolean united() &#123;        return this.distinct == 1;    &#125;&#125;public List&lt;Boolean&gt; areConnected(int n, int threshold, int[][] queries) &#123;    List&lt;Boolean&gt; res = new ArrayList();    if (threshold == 0) &#123;        for (int i = 0; i &lt; queries.length; i++) res.add(true);        return res;    &#125;    UF uf = new UF(n);    // the connected number must bigger than threshold    for (int i = threshold + 1; i &lt;= n; i++) &#123;        for (int j = i * 2; j &lt;= n; j += i) &#123;            uf.unite(i, j);        &#125;    &#125;    for (int[] query : queries) &#123;        res.add(uf.connect(query[0], query[1]));    &#125;    return res;&#125;&#125;</code></pre><h3 id="Complexity-3"><a href="#Complexity-3" class="headerlink" title="Complexity"></a>Complexity</h3><p>Time: O(n * log(n)) build union find<br>Space: O(n)    </p><h1 id="Tricky"><a href="#Tricky" class="headerlink" title="Tricky"></a>Tricky</h1><h2 id="GrayCode"><a href="#GrayCode" class="headerlink" title="GrayCode"></a>GrayCode</h2><h3 id="1611-Minimum-One-Bit-Operations-to-Make-Integers-Zero"><a href="#1611-Minimum-One-Bit-Operations-to-Make-Integers-Zero" class="headerlink" title="1611. Minimum One Bit Operations to Make Integers Zero"></a>1611. Minimum One Bit Operations to Make Integers Zero</h3><p><strong>Question description</strong></p><p><a href="https://leetcode.com/problems/minimum-one-bit-operations-to-make-integers-zero/">1611. Minimum One Bit Operations to Make Integers Zero</a><br>Given an integer n, you must transform it into 0 using the following operations any number of times:</p><ul><li><p>Change the rightmost (0th) bit in the binary representation of n.</p></li><li><p>Change the ith bit in the binary representation of n if the (i-1)th bit is set to 1 and the (i-2)th through 0th bits are set to 0.<br>Return the minimum number of operations to transform n into 0.  </p></li><li><p>Example 1</p><blockquote><p>Input: n = 0<br>Output: 0</p></blockquote></li><li><p>Example 2</p><blockquote><p>Input: n = 3<br>Output: 2<br>Explanation: The binary representation of 3 is “11”.<br>“11” -&gt; “01” with the 2nd operation since the 0th bit is 1.<br>“01” -&gt; “00” with the 1st operation.</p></blockquote></li><li><p>Example 3</p><blockquote><p>Input: n = 6<br>Output: 4<br>Explanation: The binary representation of 6 is “110”.<br>“110” -&gt; “010” with the 2nd operation since the 1st bit is 1 and 0th through 0th bits are 0.<br>“010” -&gt; “011” with the 1st operation.<br>“011” -&gt; “001” with the 2nd operation since the 0th bit is 1.<br>“001” -&gt; “000” with the 1st operation.</p></blockquote></li><li><p>Example 4</p><blockquote><p>Input: n = 9<br>Output: 14</p></blockquote></li><li><p>Example 5</p><blockquote><p>Input: n = 333<br>Output: 393</p></blockquote></li><li><p>Constraints:</p><blockquote><p>0 &lt;= n &lt;= 10<sup>9</sup></p></blockquote></li></ul><h3 id="Code-amp-Explanation-3"><a href="#Code-amp-Explanation-3" class="headerlink" title="Code &amp; Explanation"></a>Code &amp; Explanation</h3><p><a href="https://en.wikipedia.org/wiki/Gray_code">GrayCode</a> always has the least number of bit changes, so treating the given number as grey code and converting it to decimal gives the correct answer.  </p><table><thead><tr><th align="center">Decimal</th><th align="center">Binary</th><th align="center">GrayCode</th></tr></thead><tbody><tr><td align="center">0</td><td align="center">0000</td><td align="center">0000</td></tr><tr><td align="center">1</td><td align="center">0001</td><td align="center">0001</td></tr><tr><td align="center">2</td><td align="center">0010</td><td align="center">0011</td></tr><tr><td align="center">3</td><td align="center">0011</td><td align="center">0010</td></tr><tr><td align="center">4</td><td align="center">0100</td><td align="center">0110</td></tr><tr><td align="center">5</td><td align="center">0101</td><td align="center">0111</td></tr><tr><td align="center">6</td><td align="center">0110</td><td align="center">0101</td></tr><tr><td align="center">7</td><td align="center">0111</td><td align="center">0100</td></tr><tr><td align="center">8</td><td align="center">1000</td><td align="center">1100</td></tr><tr><td align="center">9</td><td align="center">1001</td><td align="center">1101</td></tr><tr><td align="center">10</td><td align="center">1010</td><td align="center">1111</td></tr><tr><td align="center">11</td><td align="center">1011</td><td align="center">1110</td></tr><tr><td align="center">12</td><td align="center">1100</td><td align="center">1010</td></tr><tr><td align="center">13</td><td align="center">1101</td><td align="center">1011</td></tr><tr><td align="center">14</td><td align="center">1110</td><td align="center">1001</td></tr><tr><td align="center">15</td><td align="center">1111</td><td align="center">1000</td></tr></tbody></table><p><strong>decimal to graycode</strong><br>fix the first digit, xor from left to right<br><em>1101</em>  =&gt; <em>1</em> (the first digit is fixed) =&gt; <em>10</em> (since the first two digit is same) =&gt; <em>101</em> (since the second digit is different with the third digit) =&gt; <em>1011</em> (the last two digit is different)</p><p><strong>graycode to decimal</strong><br>fix the first digit, decode from left to right<br><em>1011</em> =&gt; <em>1</em> (fix the first digit) =&gt; <em>11</em> (the second is 0, so still is 1) =&gt; <em>110</em> (the third is 1, so change from 1 to 0) =&gt; <em>1101</em> (the last is 1, so change from 0 to 1)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line">   public int minimumOneBitOperations(int n) &#123;</span><br><span class="line">       &#x2F;&#x2F;graycode to decimal</span><br><span class="line">       int res &#x3D; 0;</span><br><span class="line">       while (n !&#x3D; 0) &#123;</span><br><span class="line">           res ^&#x3D; n;</span><br><span class="line">           n &gt;&gt;&#x3D; 1;</span><br><span class="line">       &#125;</span><br><span class="line">       </span><br><span class="line">       return res;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;*</span><br><span class="line">Input 9 Expect output 14</span><br><span class="line"></span><br><span class="line">init  </span><br><span class="line">n &#x3D; 9 &#x3D; 1001  </span><br><span class="line">res &#x3D; 0  </span><br><span class="line">loop 1</span><br><span class="line">res ^&#x3D; n &#x3D;&gt; res &#x3D; 0000 ^ 1001 &#x3D; 1001</span><br><span class="line">n &gt;&gt; 1 &#x3D;&gt; n &#x3D; 100</span><br><span class="line">loop 2  </span><br><span class="line">res ^&#x3D; n &#x3D;&gt; res &#x3D; 1001 ^ 100 &#x3D; 1101  </span><br><span class="line">n &gt;&gt; 1 &#x3D;&gt; n &#x3D; 10  </span><br><span class="line">loop 3  </span><br><span class="line">res ^&#x3D; n &#x3D;&gt; res &#x3D; 1101 ^ 10 &#x3D; 1111  </span><br><span class="line">n &gt;&gt; 1 &#x3D;&gt; n &#x3D; 1  </span><br><span class="line">loop 4  </span><br><span class="line">res ^&#x3D; n &#x3D;&gt; res &#x3D; 1111 ^ 1 &#x3D; 1110</span><br><span class="line">n &gt;&gt; 1 &#x3D;&gt; n &#x3D; 0  </span><br><span class="line">end </span><br><span class="line">return res &#x3D; 14</span><br><span class="line">*&#x2F;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Complexity-4"><a href="#Complexity-4" class="headerlink" title="Complexity"></a>Complexity</h3><p>Time: O(n.bit.length)<br>Space: O(1)</p><h2 id="BitMask"><a href="#BitMask" class="headerlink" title="BitMask"></a>BitMask</h2><h3 id="1617-Count-Subtrees-With-Max-Distance-Between-Cities"><a href="#1617-Count-Subtrees-With-Max-Distance-Between-Cities" class="headerlink" title="1617. Count Subtrees With Max Distance Between Cities"></a>1617. Count Subtrees With Max Distance Between Cities</h3><p><strong>Question description</strong></p><p><a href="https://leetcode.com/problems/count-subtrees-with-max-distance-between-cities/">1617. Count Subtrees With Max Distance Between Cities  </a><br>There are n cities numbered from 1 to n. You are given an array edges of size n-1, where edges[i] = [ui, vi] represents a bidirectional edge between cities ui and vi. There exists a unique path between each pair of cities. In other words, the cities form a <strong>tree</strong>.</p><p>A <strong>subtree</strong> is a subset of cities where every city is reachable from every other city in the subset, where the path between each pair passes through only the cities from the subset. Two subtrees are different if there is a city in one subtree that is not present in the other.</p><p>For each d from 1 to n-1, find the number of subtrees in which the <strong>maximum distance</strong> between any two cities in the subtree is equal to d.</p><p>Return an array of size n-1 where the dth element <strong>(1-indexed)</strong> is the number of subtrees in which the <strong>maximum distance</strong> between any two cities is equal to d.</p><p><strong>Notice</strong> that the <strong>distance</strong> between the two cities is the number of edges in the path between them.</p><ul><li><p>Example 1  </p><blockquote><p>Input: n = 4, edges = [[1,2],[2,3],[2,4]]<br>Output: [3,4,0]<br>Explanation:<br>The subtrees with subsets {1,2}, {2,3} and {2,4} have a max distance of 1.<br>The subtrees with subsets {1,2,3}, {1,2,4}, {2,3,4} and {1,2,3,4} have a max distance of 2.<br>No subtree has two nodes where the max distance between them is 3.</p></blockquote></li><li><p>Example 2</p><blockquote><p>Input: n = 2, edges = [[1,2]]<br>Output: [1]</p></blockquote></li><li><p>Example 3</p><blockquote><p>Input: n = 3, edges = [[1,2],[2,3]]<br>Output: [2,1]</p></blockquote></li><li><p>Constraints:</p><blockquote><p>2 &lt;= n &lt;= 15(the biggest n is 15 indicates that time complexity should related to 2<sup>n</sup>)<br>edges.length == n-1<br>edges[i].length == 2<br>1 &lt;= u<sub>i</sub>, v<sub>i</sub> &lt;= n<br>All pairs (u<sub>i</sub>, v<sub>i</sub>) are distinct. </p></blockquote></li></ul><h3 id="Code-amp-Explanation-4"><a href="#Code-amp-Explanation-4" class="headerlink" title="Code &amp; Explanation"></a>Code &amp; Explanation</h3><p>Try every pair of n cities.<br>From example 1, n = 4, edges = [[1,2],[2,3],[2,4]]<br>we use bit mast to represemt where it is in this pair.<br>0000(all absence)<br>0001<br>0010<br>0011<br>0100<br>0101<br>0110<br>0111<br>1000<br>1001<br>1010<br>1011<br>1100<br>1101<br>1110<br>1111(all in)  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line">    public int[] countSubgraphsForEachDiameter(int n, int[][] edges) &#123;</span><br><span class="line">        int[][] dist &#x3D; new int[n][n];</span><br><span class="line">        List&lt;Integer&gt;[] neighbor &#x3D; new List[n];</span><br><span class="line">        for (int i &#x3D; 0; i &lt; n; i++) neighbor[i] &#x3D; new ArrayList();</span><br><span class="line">        for (int[] edge : edges) &#123;</span><br><span class="line">            neighbor[edge[0] - 1].add(edge[1] - 1);</span><br><span class="line">            neighbor[edge[1] - 1].add(edge[0] - 1);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; use DFS to build a graph, and record distance between each nodes</span><br><span class="line">        for (int i &#x3D; 0; i &lt; n; i++)</span><br><span class="line">            callDFS(dist, neighbor, i, -1, i, 0);</span><br><span class="line">        </span><br><span class="line">        int[] res &#x3D; new int[n-1];</span><br><span class="line">        &#x2F;&#x2F; i from 1 to (1&lt;&lt;n), loop every pair, n &#x3D; 4, (1 &lt;&lt; n) &#x3D; 16, i &#x3D; [1, 16), no 0 is because every pari can not be empty </span><br><span class="line">        for (int i &#x3D; 1; i &lt; (1 &lt;&lt; n); i++) &#123;</span><br><span class="line">            int adjacent &#x3D; 0;</span><br><span class="line">            int cities &#x3D; 0;</span><br><span class="line">            int maxDist &#x3D; 0;</span><br><span class="line">            </span><br><span class="line">            for (int j &#x3D; 0; j &lt; n; j++) &#123;</span><br><span class="line">            &#x2F;&#x2F; check if this node in this pair</span><br><span class="line">                if ((i &amp; (1 &lt;&lt; j)) !&#x3D; 0) &#123;</span><br><span class="line">                    cities ++;</span><br><span class="line">                    </span><br><span class="line">                    for (int k &#x3D; j + 1; k &lt; n; k++) &#123;</span><br><span class="line">                    &#x2F;&#x2F; check if this node int this pair</span><br><span class="line">                        if ((i &amp; (1 &lt;&lt; k)) !&#x3D; 0) &#123;</span><br><span class="line">                        &#x2F;&#x2F; record the maxDist in this pair</span><br><span class="line">                            maxDist &#x3D; Math.max(maxDist, dist[j][k]);</span><br><span class="line">                            &#x2F;&#x2F; record how many direct line in this pair</span><br><span class="line">                            if (dist[j][k] &#x3D;&#x3D; 1) adjacent++;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            &#x2F;&#x2F; check this graph is valid</span><br><span class="line">            if (cities &#x3D;&#x3D; adjacent + 1 &amp;&amp; maxDist &gt; 0) res[maxDist - 1]++;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        return res;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    private void callDFS(int[][] dist, List&lt;Integer&gt;[] neighbor, int root, int pre, int cur, int curDist) &#123;</span><br><span class="line">        if (pre &#x3D;&#x3D; cur) return;</span><br><span class="line">        </span><br><span class="line">        dist[root][cur] &#x3D; curDist;</span><br><span class="line">        dist[cur][root] &#x3D; curDist;</span><br><span class="line">        </span><br><span class="line">        for (int neighbo : neighbor[cur]) &#123;</span><br><span class="line">            if (neighbo !&#x3D; pre) &#123;</span><br><span class="line">                callDFS(dist, neighbor, root, cur, neighbo, curDist+1);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Complexity-5"><a href="#Complexity-5" class="headerlink" title="Complexity"></a>Complexity</h3><p>Time: O(2<sup>n</sup> * n * n)<br>Space: O(n<sup>2</sup>)</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;strong&gt;Instroduction&lt;/strong&gt; In order to summarize the algorithm of Leetcode encountered&lt;/p&gt;</summary>
    
    
    
    <category term="leetcode" scheme="http://example.com/categories/leetcode/"/>
    
    
    <category term="algorithm" scheme="http://example.com/tags/algorithm/"/>
    
  </entry>
  
  <entry>
    <title>Computer Architecture</title>
    <link href="http://example.com/2020/10/13/Computer-Architecture/"/>
    <id>http://example.com/2020/10/13/Computer-Architecture/</id>
    <published>2020-10-14T04:44:02.000Z</published>
    <updated>2020-11-09T04:36:49.430Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Introduction</strong> Take notes for the computer structure and write down the knowledge points in each chapter  </p><a id="more"></a><h1 id="Chapter-1"><a href="#Chapter-1" class="headerlink" title="Chapter 1"></a>Chapter 1</h1><h2 id="Main-formula"><a href="#Main-formula" class="headerlink" title="Main formula"></a>Main formula</h2><h3 id="CPU-TIME"><a href="#CPU-TIME" class="headerlink" title="CPU_TIME"></a>CPU_TIME</h3><p><img src="/img/CA/1_01.jpg" alt="CPU_Time"><br>CPU TIME = execution time<br>CPU TIME = instructions * CPI * cycle time<br>CPU TIME = (instructions * CPI) / clock rate<br>CPU TIME = clock cycles / clock rate<br>CPU TIME = (Σ(instructions * CPI)) / clock rate</p><h3 id="Instruction-Count-amp-CPI"><a href="#Instruction-Count-amp-CPI" class="headerlink" title="Instruction Count &amp; CPI"></a>Instruction Count &amp; CPI</h3><p><img src="/img/CA/1_02.jpg" alt="Instruction"><br>instructions = clock cycles / cycles per instruction<br>instructions = CPU TIME / CPI / cycle time<br>instructions = CPU TIME * clock rate / CPI  </p><p>clock cycles = Σ(instructions * CPI)<br>clock cycles = instructions * CPI  </p><p>CPI = clock cycles / instructions<br>CPI = Σ ( CPI<sub>i</sub> * (instructions<sub>i</sub> / instructions))</p><h3 id="BIG-Picture"><a href="#BIG-Picture" class="headerlink" title="BIG Picture"></a>BIG Picture</h3><p><img src="/img/CA/1_03.jpg" alt="Instruction"> </p><h3 id="Pitfall-Amdahl’s-Law"><a href="#Pitfall-Amdahl’s-Law" class="headerlink" title="Pitfall: Amdahl’s Law"></a>Pitfall: Amdahl’s Law</h3><p><img src="/img/CA/1_04.jpg" alt="Instruction">   </p><h3 id="MIPS-amp-IPS"><a href="#MIPS-amp-IPS" class="headerlink" title="MIPS &amp; IPS"></a>MIPS &amp; IPS</h3><p><img src="/img/CA/1_05.jpg" alt="Instruction"><br>IPS = (instructions / CPU_TIME) = clock_rate / CPI  </p><p>MIPS = instructions / (execution_time * 10 ^ 6)<br>MIPS = (instructions) / ((instructions * CPI / clock_rate) * 10 ^ 6)<br>MIPS = clock_rate / (CPI * 10 ^ 6)  </p><h1 id="Chapter-2"><a href="#Chapter-2" class="headerlink" title="Chapter 2"></a>Chapter 2</h1><h2 id="RISC-V-Instruction"><a href="#RISC-V-Instruction" class="headerlink" title="RISC-V Instruction"></a>RISC-V Instruction</h2><p><img src="/img/CA/2_01.jpg">  </p><h3 id="R-Type-regular"><a href="#R-Type-regular" class="headerlink" title="R-Type(regular)"></a>R-Type(regular)</h3><p>add x9, x20, x21  =&gt; x9 = x20 + 21</p><table><thead><tr><th align="center">f7</th><th align="center">rs2</th><th align="center">rs1</th><th align="center">f3</th><th align="center">rd</th><th align="center">op</th></tr></thead><tbody><tr><td align="center">0(add)</td><td align="center">21</td><td align="center">20</td><td align="center">0</td><td align="center">9</td><td align="center">51(R)</td></tr></tbody></table><p>sub x1, x2, x3 =&gt; x1 = x2 - x3</p><table><thead><tr><th align="center">f7</th><th align="center">rs2</th><th align="center">rs1</th><th align="center">f3</th><th align="center">rd</th><th align="center">op</th></tr></thead><tbody><tr><td align="center">32(sub)</td><td align="center">3</td><td align="center">2</td><td align="center">0</td><td align="center">1</td><td align="center">51(R)</td></tr></tbody></table><h3 id="I-type-Immediate"><a href="#I-type-Immediate" class="headerlink" title="I-type(Immediate)"></a>I-type(Immediate)</h3><p>Immediate field = funct7 + rs2 : 12 bits, holds a constant  </p><p>ld x9 240(x22) =&gt; x9 = mem[x22 + 240]</p><table><thead><tr><th align="center">imm</th><th align="center">rs1</th><th align="center">f3</th><th align="center">rd</th><th align="center">op</th></tr></thead><tbody><tr><td align="center">240</td><td align="center">22</td><td align="center">3</td><td align="center">9</td><td align="center">3(ld)</td></tr></tbody></table><p>addi X8, X9, 100 =&gt; x8 = x9 + 100</p><table><thead><tr><th align="center">imm</th><th align="center">rs1</th><th align="center">f3</th><th align="center">rd</th><th align="center">op</th></tr></thead><tbody><tr><td align="center">100</td><td align="center">9</td><td align="center">3</td><td align="center">8</td><td align="center">addi</td></tr></tbody></table><h3 id="S-type-sd"><a href="#S-type-sd" class="headerlink" title="S-type(sd)"></a>S-type(sd)</h3><p>sd x1, 1000(x2) =&gt; mem(1000 + x2) = x1</p><table><thead><tr><th align="center">f7</th><th align="center">rs2</th><th align="center">rs1</th><th align="center">f3</th><th align="center">rd</th><th align="center">op</th></tr></thead><tbody><tr><td align="center">31</td><td align="center">1</td><td align="center">2</td><td align="center">3</td><td align="center">8</td><td align="center">35(sd)</td></tr></tbody></table><p>1000 = 512+256+128+64+32+8 = 0011111(f7) 01000(rd)</p><h3 id="SB-type-branch"><a href="#SB-type-branch" class="headerlink" title="SB-type(branch)"></a>SB-type(branch)</h3><p>bne x10, x11, 2000. if x 10!= x11 take the branch</p><table><thead><tr><th align="center">f7</th><th align="center">rs2</th><th align="center">rs1</th><th align="center">f3</th><th align="center">rd</th><th align="center">op</th></tr></thead><tbody><tr><td align="center"><div style="width: 70pt"> 0(1bit) 62(6bit)</td><td align="center">11</td><td align="center">10</td><td align="center">001</td><td align="center"><div style="width: 70pt"> 8(4bit) 0(1bit)</td><td align="center">103(bne)</td></tr></tbody></table><p>2000 = 0 111110 1000 0</p><h3 id="UJ-type-jal"><a href="#UJ-type-jal" class="headerlink" title="UJ-type(jal)"></a>UJ-type(jal)</h3><p>jal x0 2000 =&gt; (1) x0 = PC + 4 (2) PC = PC + 2000<br>f7 + rs2 + rs1 + f3 = imm[20] + imm[10 : 1] + imm[11] + imm[19:12]</p><table><thead><tr><th align="center">f7</th><th align="center">rs2</th><th align="center">rs1</th><th align="center">f3</th><th align="center">rd</th><th align="center">op</th></tr></thead><tbody><tr><td align="center">0</td><td align="center">1111101000</td><td align="center">0</td><td align="center">0</td><td align="center">0</td><td align="center">1101111(jal)</td></tr></tbody></table><p>2000 = 0 00000000 0 1111101000 0</p><h3 id="summary"><a href="#summary" class="headerlink" title="summary"></a>summary</h3><p><img src="/img/CA/2_03.jpg">  </p><h3 id="example"><a href="#example" class="headerlink" title="example"></a>example</h3><table style="width: 600px; text-align: center" >    <tr>        <td>Instruction </td>         <td>Format</td>         <td>f7</td>         <td>rs2</td>         <td>rs1</td>         <td>f3</td>         <td>rd</td>        <td>op</td>     </tr>   <tr>           <td style="width: 120px;">add x15, x16, x17</td>           <td>R</td>           <td>add</td>           <td>17</td>           <td>16</td>           <td>0</td>           <td>15</td>           <td>R</td>   </tr>   <tr>           <td>sub x4, x5, x6</td>           <td>R</td>           <td>sub</td>           <td>6</td>           <td>5</td>           <td>0</td>           <td>4</td>           <td>R</td>   </tr>   <tr>           <td>addi x8, x3, 20</td>           <td>I</td>           <td colspan="2">20</td>           <td>3</td>           <td>xxx</td>           <td>8</td>           <td>addi</td>   </tr>   <tr>           <td>sd x17, 64(x21)</td>           <td>S</td>           <td>2</td>           <td>17</td>           <td>21</td>           <td>xxx</td>           <td>0</td>           <td>sd</td>   </tr>   <tr>           <td>ld x9, 8(x12)</td>           <td>I</td>           <td colspan="2">8</td>           <td>12</td>           <td>xxx</td>           <td>9</td>           <td>ld</td>   </tr>   <tr>           <td>beq x2, x3, 2000</td>           <td>SB</td>           <td>xxx</td>           <td>3</td>           <td>2</td>           <td>xxx</td>           <td>xxx</td>           <td>beq</td>   </tr>   <tr>           <td>jal x16, 1000</td>           <td>UJ</td>           <td colspan="4">1000</td>           <td>16</td>           <td>jal</td>   </tr>   <tr>           <td>addi x21, x23, 8</td>           <td>I</td>           <td colspan="2">8</td>           <td>23</td>           <td>xxx</td>           <td>21</td>           <td>addi</td>   </tr><!--    <tr>        <td rowspan="2">合并列</td>            <td >行二列二</td>      </tr>    <tr>        <td >行三列二</td>      </tr>--></table><h3 id="Addressing-Mode"><a href="#Addressing-Mode" class="headerlink" title="Addressing Mode"></a>Addressing Mode</h3><p><img src="/img/CA/2_04.jpg">   </p><ul><li><p>Branch address  </p><blockquote><p>beq x1, x2, offset =&gt; if (x1 = x2) goto brach address<br>Format of brach address:  </p><ol><li>Offset in binary, 13 bits:imm[12:0]  </li><li>Replace the least significant bit by 0(least significant bit is the most right bit)  </li><li>Branch address = PC + imm[12:0]0(add one more zero in the right, the total length is 14)</li></ol></blockquote></li></ul><h1 id="Chapter-4"><a href="#Chapter-4" class="headerlink" title="Chapter 4"></a>Chapter 4</h1><h2 id="functional-units"><a href="#functional-units" class="headerlink" title="functional units"></a>functional units</h2><p><img src="/img/CA/4_01.jpg">  </p><h2 id="DataPath"><a href="#DataPath" class="headerlink" title="DataPath"></a>DataPath</h2><h3 id="R-type"><a href="#R-type" class="headerlink" title="R-type"></a>R-type</h3><p><strong>Basic Steps</strong>  </p><ul><li>fetch instructions</li><li>select registers(rs1, rs2)</li><li>ALU operations on two data, need ALU</li><li>write back registers</li></ul><p><strong>Example</strong><br>add x3, x4, x5 =&gt; x3 = x4 + x5  </p><table><thead><tr><th align="center">f7</th><th align="center">rs2</th><th align="center">rs1</th><th align="center">f3</th><th align="center">rd</th><th align="center">op</th></tr></thead><tbody><tr><td align="center">add</td><td align="center">5</td><td align="center">4</td><td align="center">0</td><td align="center">3</td><td align="center">R</td></tr></tbody></table><p><img src="/img/CA/4_02.jpg">  </p><h3 id="I-type-Immediate-1"><a href="#I-type-Immediate-1" class="headerlink" title="I-type(Immediate)"></a>I-type(Immediate)</h3><p><strong>Basic Steps</strong>  </p><ul><li>fetch instructions</li><li>select registers(rs1)</li><li>calculate address, need ALU</li><li>access memory(read memory)</li><li>write register file(rd)</li></ul><p><strong>Example</strong><br>ld x3 64(x4) =&gt; x3 = mem[x4 + 64]  </p><table><thead><tr><th align="center">imm</th><th align="center">rs1</th><th align="center">f3</th><th align="center">rd</th><th align="center">op</th></tr></thead><tbody><tr><td align="center">64</td><td align="center">4</td><td align="center">xxx</td><td align="center">3</td><td align="center">addi</td></tr><tr><td align="center"><img src="/img/CA/4_03.jpg"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr></tbody></table><h3 id="S-type-sd-1"><a href="#S-type-sd-1" class="headerlink" title="S-type(sd)"></a>S-type(sd)</h3><p><strong>Basic Steps</strong>  </p><ul><li>fetch instructions</li><li>select two register(rs1, rs2)</li><li>calculate address, need ALU</li><li>access memory(write memory)</li></ul><p><strong>Example</strong><br>sd x3 64(x4) =&gt; mem[x4 + 64] = x3</p><table><thead><tr><th align="center">f7</th><th align="center">rs2</th><th align="center">rs1</th><th align="center">f3</th><th align="center">rd</th><th align="center">op</th></tr></thead><tbody><tr><td align="center">2</td><td align="center">3</td><td align="center">4</td><td align="center">xxx</td><td align="center">0</td><td align="center">sd</td></tr><tr><td align="center"><img src="/img/CA/4_04.jpg"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td><td align="center"></td></tr></tbody></table><h3 id="SB-type-branch-1"><a href="#SB-type-branch-1" class="headerlink" title="SB-type(branch)"></a>SB-type(branch)</h3><p><strong>Basic Steps</strong>  </p><ul><li>fetch instructions</li><li>select registers</li><li>test condition, calculate branch address(need additional ALU)</li></ul><p><img src="/img/CA/4_05.jpg"></p><p><strong>Example</strong><br>beq x1, x2, offset =&gt; if x1 = x2, pc = offset + pc + 4</p><table><thead><tr><th align="center">f7</th><th align="center">rs2</th><th align="center">rs1</th><th align="center">f3</th><th align="center">rd</th><th align="center">op</th></tr></thead><tbody><tr><td align="center">xxx</td><td align="center">2</td><td align="center">1</td><td align="center">xxx</td><td align="center">xxx</td><td align="center">beq</td></tr></tbody></table><h3 id="UJ-type-jal-1"><a href="#UJ-type-jal-1" class="headerlink" title="UJ-type(jal)"></a>UJ-type(jal)</h3><p><strong>Example</strong><br>jal x0 2000 =&gt; (1) x0 = PC + 4 (2) PC = PC + 2000<br><img src="/img/CA/4_12.jpg"> </p><h3 id="Single-Datapath-for-Single-Cycle"><a href="#Single-Datapath-for-Single-Cycle" class="headerlink" title="Single Datapath for Single Cycle"></a>Single Datapath for Single Cycle</h3><p><img src="/img/CA/4_06.jpg"><br><img src="/img/CA/4_07.jpg"><br><img src="/img/CA/4_08.jpg">  </p><p><img src="/img/CA/4_09.jpg">  </p><h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><p><img src="/img/CA/4_10.jpg">  </p><p>Data Memory is only used during load and store.  </p><h3 id="Function-code-of-ALU-Control"><a href="#Function-code-of-ALU-Control" class="headerlink" title="Function code of ALU Control"></a>Function code of ALU Control</h3><p>ALU used for  </p><ul><li>Load/Store: F = add  </li><li>Branch: F = subtract</li><li>R-type: F depends on f7,f3</li></ul><table><thead><tr><th align="center">ALU control</th><th align="center">Function</th></tr></thead><tbody><tr><td align="center">0000</td><td align="center">AND</td></tr><tr><td align="center">0001</td><td align="center">OR</td></tr><tr><td align="center">0010</td><td align="center">add</td></tr><tr><td align="center">0110</td><td align="center">subtract</td></tr></tbody></table><p><strong>truth table</strong><br><img src="/img/CA/4_11.jpg">  </p><h3 id="Summary-of-execution-Time-Analysis"><a href="#Summary-of-execution-Time-Analysis" class="headerlink" title="Summary of execution Time Analysis"></a>Summary of execution Time Analysis</h3><p><img src="/img/CA/4_13.jpg">  </p><h3 id="optimization-replace-amp-eliminated-control-line"><a href="#optimization-replace-amp-eliminated-control-line" class="headerlink" title="optimization(replace &amp; eliminated control line)"></a>optimization(replace &amp; eliminated control line)</h3><p><img src="/img/CA/4_14.jpg">  </p><h3 id="cycle-time-example"><a href="#cycle-time-example" class="headerlink" title="cycle time example"></a>cycle time example</h3><p><img src="/img/CA/4_15.jpg">  </p><h2 id="PipeLine"><a href="#PipeLine" class="headerlink" title="PipeLine"></a>PipeLine</h2><h3 id="Basic-idea-of-pipeline"><a href="#Basic-idea-of-pipeline" class="headerlink" title="Basic idea of pipeline"></a>Basic idea of pipeline</h3><ul><li><p>5 steps: IF(instruction fetch), ID(Instruction decoding), EX(execution), MEM(memory access), WB(write back).</p></li><li><p>For the current step, hardware of other steps are idle.</p></li><li><p>Use the idle hardware to work on other instructions  </p><blockquote><p>Overlap the instructions executions<br>Add buffers to hold partial results of instruction executions</p></blockquote></li></ul><h3 id="RISC-V-Pipelined-Datapath"><a href="#RISC-V-Pipelined-Datapath" class="headerlink" title="RISC-V Pipelined Datapath"></a>RISC-V Pipelined Datapath</h3><p><img src="/img/CA/4_16.jpg"></p><h3 id="Pipeline-Control"><a href="#Pipeline-Control" class="headerlink" title="Pipeline Control"></a>Pipeline Control</h3><p><img src="/img/CA/4_17.jpg"></p><p><strong>Example</strong> add x4, x2, x3<br><img src="/img/CA/4_18.jpg">  </p><ul><li>Execution time of <strong>n</strong> instructions </li></ul><blockquote><p>5 + n - 1 = n + 4, the first instruction is 5 cycle time, the remaining instruciton is 1 cycle time.</p></blockquote><ul><li>Speedup  </li></ul><blockquote><p>(5 * n) / (n + 4) ≈ 5</p></blockquote><ul><li>CPI = cycle time / instruction = (n + 4) / n ≈ 1</li></ul><h3 id="Buffer-size"><a href="#Buffer-size" class="headerlink" title="Buffer size"></a>Buffer size</h3><ul><li>IF/ID: 32(inst) + 64(PC) = 96</li><li>ID/EX: 2+3+3+64*4+4+5 = 273</li><li>EX/MEM: 2+3+1+64*3+5 = 203</li><li>MEM/WB: 2+5+64*2 = 135<br><img src="/img/CA/4_19.jpg">  </li></ul><p><strong>Example: How the five instructions go through the pipe, and what are the buffer values</strong><br><img src="/img/CA/4_20.jpg"><br><img src="/img/CA/4_21.jpg"><br><img src="/img/CA/4_22.jpg">  </p><h3 id="Data-Hazards"><a href="#Data-Hazards" class="headerlink" title="Data Hazards"></a>Data Hazards</h3><p><img src="/img/CA/4_23.jpg"><br><img src="/img/CA/4_24.jpg"><br><strong>WAW,WAR won’t cause Data Hazards</strong>, because write is the last process of instruction, write always after the read.</p><h3 id="Handle-Data-Hazards"><a href="#Handle-Data-Hazards" class="headerlink" title="Handle Data Hazards"></a>Handle Data Hazards</h3><ul><li><p>Compiler approach  </p><blockquote><p>insert dummy operations or “nops”<br>reschedule instructions</p></blockquote></li><li><p>Hardware approach</p><blockquote><p>forwarding</p></blockquote></li></ul><p><strong>Example</strong><br><img src="/img/CA/4_25.jpg"><br><img src="/img/CA/4_26.jpg">  </p><h3 id="How-to-identify-all-dependence"><a href="#How-to-identify-all-dependence" class="headerlink" title="How to identify all dependence"></a>How to identify all dependence</h3><ul><li>Find all instructions that write registers</li><li>For each such instruction writing register x<sub>j</sub>, identify all other instructions that either read or write register x<sub>j</sub></li><li>Data dependence graph(DDG)<br><img src="/img/CA/4_27.jpg">  </li></ul><h3 id="Forwarding"><a href="#Forwarding" class="headerlink" title="Forwarding"></a>Forwarding</h3><p><img src="/img/CA/4_29.jpg"><br><img src="/img/CA/4_28.jpg">  </p><p><img src="/img/CA/4_30.jpg"><br><strong>basic forwarding path</strong><br><img src="/img/CA/4_31.jpg">  </p><h4 id="Detecting-the-need-to-Forward"><a href="#Detecting-the-need-to-Forward" class="headerlink" title="Detecting the need to Forward"></a>Detecting the need to Forward</h4><p><img src="/img/CA/4_32.jpg">  </p><ul><li><p>But only if forwarding instructions will write to a register!  </p><blockquote><p>EX/MEM.RegWrite, MEM/WB.RegWrite</p></blockquote></li><li><p>Only if Rd for that instruction is not 0</p><blockquote><p>EX/MEM.RegisterRd!=0<br>MEM/WB.RegisterRd!=0</p></blockquote></li></ul><h4 id="summary-forwarding-conditions"><a href="#summary-forwarding-conditions" class="headerlink" title="summary-forwarding conditions"></a>summary-forwarding conditions</h4><p><img src="/img/CA/4_33.jpg">  </p><h3 id="A-Bug-Double-Data-Hazard"><a href="#A-Bug-Double-Data-Hazard" class="headerlink" title="A Bug: Double Data Hazard"></a>A Bug: Double Data Hazard</h3><ul><li><p>Consider the sequence:  </p><blockquote><p>add x1, x1, x2<br>add x1, x1, x3<br>add x1, x1, x4</p></blockquote></li><li><p>Both hazards occur</p><blockquote><p>Want to use the most recent</p></blockquote></li><li><p>Revise MEM hazard condition</p><blockquote><p>Only forward if EX hazard condition isn’t true</p></blockquote></li></ul><p><img src="/img/CA/4_34.jpg">  </p><h3 id="Load-use-Hazard-can’t-forward"><a href="#Load-use-Hazard-can’t-forward" class="headerlink" title="Load-use Hazard, can’t forward"></a>Load-use Hazard, can’t forward</h3><p><img src="/img/CA/4_35.jpg"><br><img src="/img/CA/4_36.jpg">  </p><h3 id="Harzard-Detection"><a href="#Harzard-Detection" class="headerlink" title="Harzard Detection"></a>Harzard Detection</h3><p><img src="/img/CA/4_37.jpg">  </p><ul><li><p>check if instruction x1 in EX and instruction in ID have Load Harzard. </p></li><li><p>ALU operand register numbers in ID stage are given by</p><blockquote><p>IF/ID.RegisterRs1, IF/ID.RegisterRs2</p></blockquote></li><li><p>Load-use harzard when</p><blockquote><p>ID/EX.MemRead and<br>  ((ID/EX.RegisterRd = IF/ID.RegisterRs1) or<br>  (ID/EX.RegisterRd = IF/ID.RegisterRs2))</p></blockquote></li><li><p>if detected, stall and insert bubble</p></li></ul><h4 id="How-to-Stall-the-Pipeline"><a href="#How-to-Stall-the-Pipeline" class="headerlink" title="How to Stall the Pipeline"></a>How to Stall the Pipeline</h4><ul><li><p>Force control values in ID/EX register to 0</p><blockquote><p>EX,MEM and WB do <strong>nop</strong>(no-operation)</p></blockquote></li><li><p>Prevent update of PC and IF/ID register</p><blockquote><p>Using instruction is decoded again<br>Following instruction is fetched again<br>1-cycle stall allows MEM to read data for <strong>ld</strong>  </p><pre><code>  - Can subsequently forward to EX stage</code></pre></blockquote></li></ul><p><img src="/img/CA/4_38.jpg">  </p><h3 id="Branch-Hazards"><a href="#Branch-Hazards" class="headerlink" title="Branch Hazards"></a>Branch Hazards</h3><p><img src="/img/CA/4_39.jpg">  </p><h3 id="Handle-Branch-Hazards"><a href="#Handle-Branch-Hazards" class="headerlink" title="Handle Branch Hazards"></a>Handle Branch Hazards</h3><p><strong>just lose 1 cycle when branch is taken</strong></p><p><img src="/img/CA/4_40.jpg">  </p><h3 id="Flushing-instrucion-summary"><a href="#Flushing-instrucion-summary" class="headerlink" title="Flushing instrucion summary"></a>Flushing instrucion summary</h3><p><img src="/img/CA/4_41.jpg">  </p><h3 id="Performance-Analysis-–-Individual-CPI"><a href="#Performance-Analysis-–-Individual-CPI" class="headerlink" title="Performance Analysis – Individual CPI"></a>Performance Analysis – Individual CPI</h3><h4 id="Basic-pipeline"><a href="#Basic-pipeline" class="headerlink" title="Basic pipeline"></a>Basic pipeline</h4><p><img src="/img/CA/4_42.jpg">  </p><h4 id="Advanced-pipeline"><a href="#Advanced-pipeline" class="headerlink" title="Advanced pipeline"></a>Advanced pipeline</h4><p><img src="/img/CA/4_43.jpg">  </p><h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><p><img src="/img/CA/4_44.jpg">  </p><h3 id="Static-Dual-Issue"><a href="#Static-Dual-Issue" class="headerlink" title="Static Dual Issue"></a>Static Dual Issue</h3><p><img src="/img/CA/4_45.jpg">  </p><h3 id="Example-1"><a href="#Example-1" class="headerlink" title="Example"></a>Example</h3><p><img src="/img/CA/4_46.jpg">  </p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;strong&gt;Introduction&lt;/strong&gt; Take notes for the computer structure and write down the knowledge points in each chapter  &lt;/p&gt;</summary>
    
    
    
    
    <category term="SCU, Campus" scheme="http://example.com/tags/SCU-Campus/"/>
    
  </entry>
  
  <entry>
    <title>How to post new</title>
    <link href="http://example.com/2020/10/13/hello-world/"/>
    <id>http://example.com/2020/10/13/hello-world/</id>
    <published>2020-10-14T00:03:42.491Z</published>
    <updated>2020-10-14T04:39:22.069Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><a id="more"></a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.io/docs/&quot;&gt;documentation&lt;/a&gt; for more info. If you get any problems when using Hexo, you can find the answer in &lt;a href=&quot;https://hexo.io/docs/troubleshooting.html&quot;&gt;troubleshooting&lt;/a&gt; or you can ask me on &lt;a href=&quot;https://github.com/hexojs/hexo/issues&quot;&gt;GitHub&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&quot;Quick-Start&quot;&gt;&lt;a href=&quot;#Quick-Start&quot; class=&quot;headerlink&quot; title=&quot;Quick Start&quot;&gt;&lt;/a&gt;Quick Start&lt;/h2&gt;&lt;h3 id=&quot;Create-a-new-post&quot;&gt;&lt;a href=&quot;#Create-a-new-post&quot; class=&quot;headerlink&quot; title=&quot;Create a new post&quot;&gt;&lt;/a&gt;Create a new post&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ hexo new &lt;span class=&quot;string&quot;&gt;&amp;quot;My New Post&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;More info: &lt;a href=&quot;https://hexo.io/docs/writing.html&quot;&gt;Writing&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;Run-server&quot;&gt;&lt;a href=&quot;#Run-server&quot; class=&quot;headerlink&quot; title=&quot;Run server&quot;&gt;&lt;/a&gt;Run server&lt;/h3&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>iOS 开发之多线程 GCD</title>
    <link href="http://example.com/2015/08/05/iOS-%E5%BC%80%E5%8F%91%E4%B9%8B%E5%A4%9A%E7%BA%BF%E7%A8%8BGCD/"/>
    <id>http://example.com/2015/08/05/iOS-%E5%BC%80%E5%8F%91%E4%B9%8B%E5%A4%9A%E7%BA%BF%E7%A8%8BGCD/</id>
    <published>2015-08-06T02:57:03.000Z</published>
    <updated>2016-05-02T06:57:03.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Grand Central Dispatch（GCD）</strong> 是 Apple 开发的一个多核编程的较新的解决方法。它主要用于优化应用程序以支持多核处理器以及其他对称多处理系统。它是一个在线程池模式的基础上执行的并发任务。GCD 可用于多核的并行运算；GCD 会自动利用更多的 CPU 内核（比如双核、四核）；GCD 会自动管理线程的生命周期（创建线程、调度任务、销毁线程）；</p><a id="more"></a><h1 id="同步-amp-异步"><a href="#同步-amp-异步" class="headerlink" title="同步&amp;异步"></a>同步&amp;异步</h1><p>同步和异步的概念主要区别：具不具备开启新的线程的能力，决定了任务在哪一个线程执行了；但更确切的说同步（sync）和 异步（async）的区别在于会不会阻塞当前线程，直到 Block 中的任务执行完毕；同步（sync） 操作，它会阻塞当前线程并等待 Block 中的任务执行完毕，然后当前线程才会继续往下运行。异步（async）操作，当前线程会直接往下执行，它不会阻塞当前线程；</p><ul><li><p>同步：在当前线程中执行任务，不具备开启新线程的能力；</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dispatch_sync</span>(<span class="built_in">dispatch_queue_t</span> queue, DISPATCH_NOESCAPE dispatch_block_t block);</span><br></pre></td></tr></table></figure></li><li><p>异步：在新的线程中执行任务，具备开启新线程的能力；</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(<span class="built_in">dispatch_queue_t</span> queue, dispatch_block_t block);</span><br></pre></td></tr></table></figure></li></ul><h1 id="任务-amp-队列"><a href="#任务-amp-队列" class="headerlink" title="任务&amp;队列"></a>任务&amp;队列</h1><p>任务：即具体要干的事情要执行的操作，一般是一段代码块，在 GCD 中是一个 就是一个 Block 块，<strong>这里需要特意留意下任务是 Block 块</strong>；任务存放于队列中，任务有两种执行方式：是串行还是并行；同步和异步决定任务在那条线程中执行；</p><p>队列：用于存放任务，GCD 中队列分为两大类 <code>dispatch_queue_t</code>，串行队列 和 并行队列，队列的类型决定了任务的执行方式；</p><ul><li><p>串行队列：放到串行队列的任务，任务会以 FIFO（先进先出）的方式地取出来，让任务一个接着一个地执行（一个任务执行完毕后，再执行下一个任务），实际上串行队列中也只能开启一条新线程；其中特殊的是系统自身就已经创建了一个主队列，对应着主线程其也是串行队列，主线程的作用是处理UI事件（点击事件、滚动事件、拖拽事情），串行队列的创建及获取有如下方式：</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 主队列 - 特殊的串行队列</span></span><br><span class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_get_main_queue();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建队列 - 串行队列</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 创建队列</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> 第一个参数： &quot;com.zerocc.testQueue&quot; 队列名 可用于 Instruments 的调试和 CrashLog 查看</span></span><br><span class="line"><span class="comment"> 第二个参数： NULL 指定为 NULL 或 DISPATCH_QUEUE_SERIAL,生成 Serial Dispatch Queue；</span></span><br><span class="line"><span class="comment"> 指定为 DISPATCH_QUEUE_CONCURRENT，生成 Concurrent Dispatch Queue。</span></span><br><span class="line"><span class="comment"> 返回值：    队列，dispatch_queue_t 类型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_queue_create(<span class="string">&quot;com.zerocc.test00Queue&quot;</span>, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_queue_create(<span class="string">&quot;com.zerocc.test01Queue&quot;</span>, DISPATCH_QUEUE_SERIAL);</span><br></pre></td></tr></table></figure></li><li><p>并发队列：放到并发队列的任务，任务也是以 FIFO 的方式取出来，但不同的是，它取出来一个就会放到一个线程，然后再取出来一个又放到另一个的线程。这样由于取的动作很快，忽略不计，看起来，所有的任务都是一起并发执行的；</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 全局并发队列</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 获取全局并发队列</span></span><br><span class="line"><span class="comment"> </span></span><br><span class="line"><span class="comment"> 第一个参数：用于指定队列优先级 一般使用默认优先级即可 DISPATCH_QUEUE_PRIORITY_DEFAULT 0；其它三种有:</span></span><br><span class="line"><span class="comment">  DISPATCH_QUEUE_PRIORITY_HIGH  2，</span></span><br><span class="line"><span class="comment">  DISPATCH_QUEUE_PRIORITY_LOW  -2，</span></span><br><span class="line"><span class="comment">  DISPATCH_QUEUE_PRIORITY_BACKGROUND INT16_MIN 2 后台优先级</span></span><br><span class="line"><span class="comment"> 第二个参数：苹果预留设计传入0即可 0</span></span><br><span class="line"><span class="comment"> 返回值：   全局并发队列</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建并发队列</span></span><br><span class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_queue_create(<span class="string">&quot;com.zerocc.test02Queue&quot;</span>, DISPATCH_QUEUE_CONCURRENT);</span><br></pre></td></tr></table></figure></li></ul><p>总结：</p><ul><li><code>dispatch_sync</code> 同步执行不管任务是在串行队列还是在并行队列，任务都是在当前线程一个接一个执行(主队列特例除外例如子线程中调用 sync + 主队列那么任务会从子线程回到主线程执行) - <a href="https://developer.apple.com/documentation/dispatch/1452870-dispatch_sync">apple documentation Discussion</a>；</li><li><code>dispatch_async</code> 异步执行任务放在串行队列，任务在其它线程一个接一个执行；任务放在并行队列，任务在多个线程中并发执行；</li></ul><h1 id="GCD-常用方法"><a href="#GCD-常用方法" class="headerlink" title="GCD 常用方法"></a>GCD 常用方法</h1><h2 id="dispatch-once-（GCD-一次性代码执行）"><a href="#dispatch-once-（GCD-一次性代码执行）" class="headerlink" title="dispatch_once （GCD 一次性代码执行）"></a>dispatch_once （GCD 一次性代码执行）</h2><p><code>dispatch_once</code> 能保证 Block 中代码块在程序运行过程只执行一次，常用于单例的创建；并且在多线程的环境下，dispatch_once 可以保证线程安全；</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">3</span>; i++) &#123;</span><br><span class="line">        [<span class="keyword">self</span> disaptchOnce];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)disaptchOnce &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>, __func__);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</span><br><span class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;dispatch_once - 执行任务&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 点击后打印结果如下, disaptchOnce 方法调用了三次，其中 dispatch_once 的 block 代码块只执行一次</span><br><span class="line">... CCBlogCode[41182:17902797] -[CCGCDVC disaptchOnce]</span><br><span class="line">... CCBlogCode[41182:17902797] dispatch_once - 执行任务</span><br><span class="line">... CCBlogCode[41182:17902797] -[CCGCDVC disaptchOnce]</span><br><span class="line">... CCBlogCode[41182:17902797] -[CCGCDVC disaptchOnce]</span><br></pre></td></tr></table></figure><h2 id="dispatch-group（GCD-队列组）"><a href="#dispatch-group（GCD-队列组）" class="headerlink" title="dispatch_group（GCD 队列组）"></a>dispatch_group（GCD 队列组）</h2><p>队列组可以将多个队列添加到一个组里，从而管理监听所有任务都执行完成情况，当所有任务都执行完成有一个回调监听。这里的多个队列可以是不同的；运用场景可以是多个网络请求的控制等例如表单类型填写上报优先级问题；实现步骤如下：</p><ul><li>创建队列组，通过调用 <code>dispatch_group_create()</code>方法创建得到 <code>dispatch_group_t</code> 类型 group；</li><li>将队列中的任务添加到队列组 group 中, 通过 <code>dispatch_group_async(队列组，队列，block)</code> 方法；次步也可以使用 <code>dispatch_group_enter</code> 和 <code>dispatch_group_leave</code> 这两个组合替代 <code>dispatch_group_async</code>, <code>dispatch_group_enter</code>：表示将一个队列中任务放入 group 队列组中，此时 group 队列组任务数加1, <code>dispatch_group_leave</code>：表示将一个队列中任务从 group 队列组撤出，此时 group 队列组任务数减1；一定是配合一对一使用否则 group 任务数不为0(也就是标志是否执行完)，任务数不为0则不会走下一步的监听回调 Block；</li><li>监听所有队列中任务完成的回调，具体任务完成回调监听方法 <code>dispatch_group_notify(队列组，队列，block)</code>；</li></ul><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GCD 队列组常规使用</span></span><br><span class="line">- (<span class="keyword">void</span>)dispatchGroup &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建一个并发队列</span></span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> queue = dispatch_queue_create(<span class="string">&quot;com.zerocc.testQueue&quot;</span>, DISPATCH_QUEUE_CONCURRENT);</span><br><span class="line">    <span class="comment">// 1. 创建队列组</span></span><br><span class="line">    dispatch_group_t group = dispatch_group_create();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 将队列中的任务添加到队列组 group 中</span></span><br><span class="line">    dispatch_group_async(group, queue, ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">5</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;任务1---%@&quot;</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    dispatch_group_async(group, queue, ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;任务2---%@&quot;</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    dispatch_group_async(group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">1</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;任务3---%@&quot;</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 监听到所有队列中任务已完成</span></span><br><span class="line">    dispatch_group_notify(group, dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;任务123都执行完毕---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 执行结果打印</span><br><span class="line">... CCBlogCode[1435:621582] 任务2---&lt;NSThread: 0x1cc07f3c0&gt;&#123;number &#x3D; 3, name &#x3D; (null)&#125;</span><br><span class="line">... CCBlogCode[1435:621582] 任务2---&lt;NSThread: 0x1cc07f3c0&gt;&#123;number &#x3D; 3, name &#x3D; (null)&#125;</span><br><span class="line">... CCBlogCode[1435:621582] 任务2---&lt;NSThread: 0x1cc07f3c0&gt;&#123;number &#x3D; 3, name &#x3D; (null)&#125;</span><br><span class="line">... CCBlogCode[1435:621584] 任务3---&lt;NSThread: 0x1c4263e80&gt;&#123;number &#x3D; 4, name &#x3D; (null)&#125;</span><br><span class="line">... CCBlogCode[1435:621584] 任务3---&lt;NSThread: 0x1c4263e80&gt;&#123;number &#x3D; 4, name &#x3D; (null)&#125;</span><br><span class="line">... CCBlogCode[1435:621584] 任务3---&lt;NSThread: 0x1c4263e80&gt;&#123;number &#x3D; 4, name &#x3D; (null)&#125;</span><br><span class="line">... CCBlogCode[1435:621581] 任务1---&lt;NSThread: 0x1c807db00&gt;&#123;number &#x3D; 5, name &#x3D; (null)&#125;</span><br><span class="line">... CCBlogCode[1435:621581] 任务1---&lt;NSThread: 0x1c807db00&gt;&#123;number &#x3D; 5, name &#x3D; (null)&#125;</span><br><span class="line">... CCBlogCode[1435:621581] 任务1---&lt;NSThread: 0x1c807db00&gt;&#123;number &#x3D; 5, name &#x3D; (null)&#125;</span><br><span class="line">... CCBlogCode[1435:621451] 任务123都执行完毕---&lt;NSThread: 0x1d007c4c0&gt;&#123;number &#x3D; 1, name &#x3D; main&#125;</span><br></pre></td></tr></table></figure><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GCD 队列组 dispatch_group_enter 和 dispatch_group_leave 配合使用</span></span><br><span class="line">- (<span class="keyword">void</span>)dispatchGroupEnterAndleave</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;currentThread---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> queue = dispatch_queue_create(<span class="string">&quot;com.zerocc.testQueue&quot;</span>, DISPATCH_QUEUE_CONCURRENT);</span><br><span class="line">    </span><br><span class="line">    dispatch_group_t group = dispatch_group_create();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 队列1任务1添加进 group 中</span></span><br><span class="line">    dispatch_group_enter(group);</span><br><span class="line">    <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; ++i) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">5</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;任务1---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">        dispatch_group_leave(group);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 队列2任务2添加进 group 中</span></span><br><span class="line">    dispatch_group_enter(group);</span><br><span class="line">    <span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; ++i) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">1</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;任务2---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">        dispatch_group_leave(group);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// enter 和 leave 一定是成对的，例如任务2中 少了enter则执行完任务2直接走下面block回调，执行完任务1后会出现崩溃；</span></span><br><span class="line">    <span class="comment">// 如果少了leave则执行完任务1和2后不走下面block回调</span></span><br><span class="line">    dispatch_group_notify(group, dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;任务12都执行完毕---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 执行结果打印</span><br><span class="line">... CCBlogCode[1467:622770] currentThread---&lt;NSThread: 0x1d406f940&gt;&#123;number &#x3D; 1, name &#x3D; main&#125;</span><br><span class="line">... CCBlogCode[1467:622862] 任务2---&lt;NSThread: 0x1c806c540&gt;&#123;number &#x3D; 3, name &#x3D; (null)&#125;</span><br><span class="line">... CCBlogCode[1467:622862] 任务2---&lt;NSThread: 0x1c806c540&gt;&#123;number &#x3D; 3, name &#x3D; (null)&#125;</span><br><span class="line">... CCBlogCode[1467:622858] 任务1---&lt;NSThread: 0x1c406cf40&gt;&#123;number &#x3D; 4, name &#x3D; (null)&#125;</span><br><span class="line">... CCBlogCode[1467:622858] 任务1---&lt;NSThread: 0x1c406cf40&gt;&#123;number &#x3D; 4, name &#x3D; (null)&#125;</span><br><span class="line">... CCBlogCode[1467:622770] 任务12都执行完毕---&lt;NSThread: 0x1d406f940&gt;&#123;number &#x3D; 1, name &#x3D; main&#125;</span><br></pre></td></tr></table></figure><p>队列组中还有一个方法 <code>dispatch_group_wait(队列组, DISPATCH_TIME_FOREVER)</code>，可以用来阻塞当前线程，这里指的当前线程为队列组 group 所在的线程。</p><h2 id="dispatch-after（GCD-延时执行）"><a href="#dispatch-after（GCD-延时执行）" class="headerlink" title="dispatch_after（GCD 延时执行）"></a>dispatch_after（GCD 延时执行）</h2><p>GCD 延时执行就是针对某个队列中的任务 (block 块中）延迟执行，通过调用方法 <code>dispatch_after(dispatch_time_t when, dispatch_queue_t queue,         dispatch_block_t block)</code> 来指定某个任务在延迟特定的时间后再执行；</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)dispatchAfter &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 主队列中任务3.0秒后延迟执行，这里也可以换成其它队列</span></span><br><span class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">3.0</span> * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;延迟2秒执行---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="dispatch-apply（GCD-快速迭代）"><a href="#dispatch-apply（GCD-快速迭代）" class="headerlink" title="dispatch_apply（GCD 快速迭代）"></a>dispatch_apply（GCD 快速迭代）</h2><p>GCD 快速迭代类似于 for 和 while 循环遍历，但是不同的是可以将执行任务代码块添加到指定队列中进行；如果任务在串行队列中执行使用 <code>dispatch_apply</code> 效果等同于一般 for 循环，如果是并发队列进行异步执行的话，<code>dispatch_apply</code> 可以在多个线程同时异步遍历执行，会自动开启新线程执行任务，并且执行的顺序是不固定的。</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GCD 快速迭代 并发队列为例</span></span><br><span class="line">- (<span class="keyword">void</span>)dispatchApply &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;迭代---begin&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    dispatch_apply(<span class="number">10</span>, queue, ^(size_t index) &#123;</span><br><span class="line">        [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;迭代%zd---%@&quot;</span>,index, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;迭代---end&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 执行结果打印</span><br><span class="line">... CCBlogCode[2001:814061] 迭代---begin</span><br><span class="line">... CCBlogCode[2001:814061] 迭代0---&lt;NSThread: 0x1d4260780&gt;&#123;number &#x3D; 1, name &#x3D; main&#125;</span><br><span class="line">... CCBlogCode[2001:814193] 迭代1---&lt;NSThread: 0x1c807e000&gt;&#123;number &#x3D; 3, name &#x3D; (null)&#125;</span><br><span class="line">... CCBlogCode[2001:814426] 迭代3---&lt;NSThread: 0x1c426c280&gt;&#123;number &#x3D; 5, name &#x3D; (null)&#125;</span><br><span class="line">... CCBlogCode[2001:814454] 迭代5---&lt;NSThread: 0x1c0263fc0&gt;&#123;number &#x3D; 7, name &#x3D; (null)&#125;</span><br><span class="line">... CCBlogCode[2001:814453] 迭代4---&lt;NSThread: 0x1cc07e340&gt;&#123;number &#x3D; 6, name &#x3D; (null)&#125;</span><br><span class="line">... CCBlogCode[2001:814425] 迭代2---&lt;NSThread: 0x1c02642c0&gt;&#123;number &#x3D; 4, name &#x3D; (null)&#125;</span><br><span class="line">... CCBlogCode[2001:814061] 迭代6---&lt;NSThread: 0x1d4260780&gt;&#123;number &#x3D; 1, name &#x3D; main&#125;</span><br><span class="line">... CCBlogCode[2001:814426] 迭代8---&lt;NSThread: 0x1c426c280&gt;&#123;number &#x3D; 5, name &#x3D; (null)&#125;</span><br><span class="line">... CCBlogCode[2001:814193] 迭代7---&lt;NSThread: 0x1c807e000&gt;&#123;number &#x3D; 3, name &#x3D; (null)&#125;</span><br><span class="line">... CCBlogCode[2001:814454] 迭代9---&lt;NSThread: 0x1c0263fc0&gt;&#123;number &#x3D; 7, name &#x3D; (null)&#125;</span><br><span class="line">... CCBlogCode[2001:814061] 迭代---end</span><br></pre></td></tr></table></figure><h2 id="dispatch-source（GCD-实现定时器）"><a href="#dispatch-source（GCD-实现定时器）" class="headerlink" title="dispatch_source（GCD 实现定时器）"></a><code>dispatch_source</code>（GCD 实现定时器）</h2><p>dispatch_source… 的使用，其中通过调用方法<code>dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, 0, 0, queue)</code>创建事件，第一个参数为 <code>dispatch_source_type_t</code> 类型，其代表指定事件类型，可以自定义事件或者 Timer 事件还有 Mach 端口相关事件等等，可以 command 点进去看API了；此文只对定时器事件运用分析。</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)dispatchSource &#123;</span><br><span class="line">    __block <span class="keyword">int</span> timeout = <span class="number">15</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//获取全局队列</span></span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     1. 创建GCD中的定时器,并将定时器的任务交给全局并发队列执行(不会造成主线程阻塞)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     第一个参数: DISPATCH_SOURCE_TYPE_TIMER source的类型 DISPATCH_SOURCE_TYPE_TIMER 表示是定时器</span></span><br><span class="line"><span class="comment">     第二个参数: 0</span></span><br><span class="line"><span class="comment">     第三个参数: 0</span></span><br><span class="line"><span class="comment">     第四个参数: queue 队列</span></span><br><span class="line"><span class="comment">     返回值： timer dispatch_source_t 类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    dispatch_source_t timer = dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, <span class="number">0</span>, <span class="number">0</span>, queue);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 设置定时器(timer 定时器，起始时间，间隔时间，精准度); 1.0 * NSEC_PER_SEC 时间单位为纳秒，设置定时器触发的时间间隔为1s; 0 * NSEC_PER_SEC 精确度 0s</span></span><br><span class="line">    dispatch_source_set_timer(timer, DISPATCH_TIME_NOW, <span class="number">1.0</span> * <span class="built_in">NSEC_PER_SEC</span>, <span class="number">0</span> * <span class="built_in">NSEC_PER_SEC</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// block内部 使用弱引用修饰 避免循环调用</span></span><br><span class="line">    __<span class="keyword">weak</span> <span class="keyword">typeof</span>(<span class="keyword">self</span>)weakSelf = <span class="keyword">self</span>;</span><br><span class="line">    weakSelf.timerBtn.userInteractionEnabled = <span class="literal">false</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 设置定时器的触发事件</span></span><br><span class="line">    dispatch_source_set_event_handler(timer, ^&#123;</span><br><span class="line">        timeout--;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (timeout &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 回到主队列主线程设置 UI</span></span><br><span class="line">            <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">                <span class="built_in">NSString</span> * title = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@&quot;%d秒后重新&quot;</span>,timeout];</span><br><span class="line">                [weakSelf.timerBtn setTitle:title forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 5. 取消定时器</span></span><br><span class="line">            dispatch_source_cancel(timer);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 6. 取消定时器回调</span></span><br><span class="line">    dispatch_source_set_cancel_handler(timer, ^&#123;</span><br><span class="line">        <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">            weakSelf.timerBtn.userInteractionEnabled = <span class="literal">YES</span>;</span><br><span class="line">            [weakSelf.timerBtn setTitle:<span class="string">@&quot;重新获取&quot;</span> forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;定时取消&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. 启动定时器</span></span><br><span class="line">    dispatch_resume(timer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="dispatch-barrier-async（GCD-栅栏方法）"><a href="#dispatch-barrier-async（GCD-栅栏方法）" class="headerlink" title="dispatch_barrier_async（GCD 栅栏方法）"></a><code>dispatch_barrier_async</code>（GCD 栅栏方法）</h2><p><code>dispatch_barrier_async</code>作用就是分割其上下两部分任务执行过程，都是异步执行但是先执行其前面的任务先，再执行自身 Block 块中的任务，最后继续往下执行；表现形式就是分割作用。</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)dispatchBarrier &#123;</span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> queue = dispatch_queue_create(<span class="string">&quot;zerocc.com.testQueue&quot;</span>, DISPATCH_QUEUE_CONCURRENT);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 任务1</span></span><br><span class="line">    <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">3</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;任务1---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 任务2</span></span><br><span class="line">    <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;任务2---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// barrier 分割等待</span></span><br><span class="line">    dispatch_barrier_async(queue, ^&#123;</span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; ++i) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;barrier---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 任务3</span></span><br><span class="line">    <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; ++i) &#123;</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;任务3---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 执行结果打印</span><br><span class="line">... CCBlogCode[30046:4604551] 任务2---&lt;NSThread: 0x600001bc0300&gt;&#123;number &#x3D; 3, name &#x3D; (null)&#125;</span><br><span class="line">... CCBlogCode[30046:4604553] 任务1---&lt;NSThread: 0x600001bc0900&gt;&#123;number &#x3D; 4, name &#x3D; (null)&#125;</span><br><span class="line">... CCBlogCode[30046:4604551] 任务2---&lt;NSThread: 0x600001bc0300&gt;&#123;number &#x3D; 3, name &#x3D; (null)&#125;</span><br><span class="line">... CCBlogCode[30046:4604553] 任务1---&lt;NSThread: 0x600001bc0900&gt;&#123;number &#x3D; 4, name &#x3D; (null)&#125;</span><br><span class="line">... CCBlogCode[30046:4604553] barrier---&lt;NSThread: 0x600001bc0900&gt;&#123;number &#x3D; 4, name &#x3D; (null)&#125;</span><br><span class="line">... CCBlogCode[30046:4604553] barrier---&lt;NSThread: 0x600001bc0900&gt;&#123;number &#x3D; 4, name &#x3D; (null)&#125;</span><br><span class="line">... CCBlogCode[30046:4604553] 任务3---&lt;NSThread: 0x600001bc0900&gt;&#123;number &#x3D; 4, name &#x3D; (null)&#125;</span><br><span class="line">... CCBlogCode[30046:4604553] 任务3---&lt;NSThread: 0x600001bc0900&gt;&#123;number &#x3D; 4, name &#x3D; (null)&#125;</span><br></pre></td></tr></table></figure><h2 id="dispatch-semaphore（GCD-信号量）"><a href="#dispatch-semaphore（GCD-信号量）" class="headerlink" title="dispatch_semaphore（GCD 信号量）"></a>dispatch_semaphore（GCD 信号量）</h2><p>GCD 信号量可以理解为一个计数器，用来控制线程并发访问的最大数量问题，保证线程同步等。信号量初始值为1，代表只允许当前线程访问资源，当信号量值小与等于零时当前线程就进入休眠等待状态。</p><ul><li>初始化信号量，调用 <code>dispatch_semaphore_create(1)</code> 方法初始化信号量值为1；</li><li>判断信号量值决定其是否能往下继续执行，通过调用方法 <code>dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER)</code>。如果信号量的值大于0，则该方法所处的线程就会继续执行，并且信号量值 -1；如果信号量值 &lt;= 0, 当前线程进入休眠等待状态，也可以通过控制第二个参数使其不一直处于等待状态，例如：DISPATCH_TIME_NOW+3 表示3秒后继续向下执行；</li><li>一个任务执行完后记得使信号量的值加1，通过调用方法 <code>dispatch_semaphore_signal</code>信号值 +1，从而后面任务可以继续执行；</li></ul><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)dispatchSemaphore &#123;</span><br><span class="line">    <span class="comment">// 创建并发队列</span></span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> queue = dispatch_queue_create(<span class="string">&quot;com.zerocc.semaphore&quot;</span>, DISPATCH_QUEUE_CONCURRENT);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 初始化信号量值为1</span></span><br><span class="line">    dispatch_semaphore_t semaphore = dispatch_semaphore_create(<span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 任务1</span></span><br><span class="line">    <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">        <span class="comment">// 2. 判断信号量值, 信号量 &gt; 0 继续执行并且信号量值 -1；信号量 &lt;= 0, 当前线程进入休眠等待状态</span></span><br><span class="line">        <span class="comment">// 这里信号量为0了，所以任务2要等待ing</span></span><br><span class="line">        dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);</span><br><span class="line">        [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">5</span>];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;任务1---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        <span class="comment">// 3. 信号量值 +1</span></span><br><span class="line">        dispatch_semaphore_signal(semaphore);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">     <span class="comment">// 任务2</span></span><br><span class="line">    <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">        dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; ++i) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">3</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;任务2---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">        dispatch_semaphore_signal(semaphore);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">     <span class="comment">// 任务3</span></span><br><span class="line">    <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">        dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; ++i) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">1</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@&quot;任务3---%@&quot;</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">        dispatch_semaphore_signal(semaphore);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 运行结果打印, 任务123先后顺序并不确定，但是是连续的，也就是说一定是保证只有一个线程执行任务，其它线程则是等待状态</span><br><span class="line">... CCBlogCode[1688:347237] 任务1---&lt;NSThread: 0x600003f3d9c0&gt;&#123;number &#x3D; 3, name &#x3D; (null)&#125;</span><br><span class="line">... CCBlogCode[1688:347235] 任务2---&lt;NSThread: 0x600003f3f1c0&gt;&#123;number &#x3D; 4, name &#x3D; (null)&#125;</span><br><span class="line">... CCBlogCode[1688:347235] 任务2---&lt;NSThread: 0x600003f3f1c0&gt;&#123;number &#x3D; 4, name &#x3D; (null)&#125;</span><br><span class="line">... CCBlogCode[1688:347235] 任务2---&lt;NSThread: 0x600003f3f1c0&gt;&#123;number &#x3D; 4, name &#x3D; (null)&#125;</span><br><span class="line">... CCBlogCode[1688:347234] 任务3---&lt;NSThread: 0x600003f3dc80&gt;&#123;number &#x3D; 5, name &#x3D; (null)&#125;</span><br><span class="line">... CCBlogCode[1688:347234] 任务3---&lt;NSThread: 0x600003f3dc80&gt;&#123;number &#x3D; 5, name &#x3D; (null)&#125;</span><br><span class="line">... CCBlogCode[1688:347234] 任务3---&lt;NSThread: 0x600003f3dc80&gt;&#123;number &#x3D; 5, name &#x3D; (null)&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;strong&gt;Grand Central Dispatch（GCD）&lt;/strong&gt; 是 Apple 开发的一个多核编程的较新的解决方法。它主要用于优化应用程序以支持多核处理器以及其他对称多处理系统。它是一个在线程池模式的基础上执行的并发任务。GCD 可用于多核的并行运算；GCD 会自动利用更多的 CPU 内核（比如双核、四核）；GCD 会自动管理线程的生命周期（创建线程、调度任务、销毁线程）；&lt;/p&gt;</summary>
    
    
    
    <category term="iOS" scheme="http://example.com/categories/iOS/"/>
    
    
    <category term="iOS" scheme="http://example.com/tags/iOS/"/>
    
  </entry>
  
</feed>
